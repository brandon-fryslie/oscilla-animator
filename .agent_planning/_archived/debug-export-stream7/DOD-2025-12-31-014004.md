# Definition of Done: Debug + Export Workstream Completion

**Generated**: 2025-12-31-014004
**Plan**: PLAN-2025-12-31-014004.md
**Source**: STATUS-2025-12-31-013400.md
**Scope**: Workstream 7 - Debug + Export (Final Verification Sprint)

---

## Sprint Scope

This sprint delivers **workstream completion** through 3 focused tasks:
1. Fix broken test fixtures (add debugProbes field)
2. Verify deterministic replay is correctly implemented
3. Validate end-to-end debug probe flow

**Deferred**: Any follow-up work items discovered during validation (will be tracked separately)

---

## Work Item 1: Fix Test Fixtures

**Task**: Add missing `debugProbes: []` field to 6 mock BuilderProgramIR objects

### Acceptance Criteria

- [ ] Add `debugProbes: []` to mock object at line 84
- [ ] Add `debugProbes: []` to mock object at line 143
- [ ] Add `debugProbes: []` to mock object at line 206
- [ ] Add `debugProbes: []` to mock object at line 249
- [ ] Add `debugProbes: []` to mock object at line 307
- [ ] Add `debugProbes: []` to mock object at line 371
- [ ] TypeScript compiles without errors (`just typecheck` passes)
- [ ] Tests run successfully (`just test` passes)
- [ ] No runtime behavior changes

---

## Work Item 2: Verify Deterministic Replay

**Task**: Confirm exporters use seeded PRNG and Math.random() audit is correct

### Acceptance Criteria

- [ ] ImageSequenceExporter creates RuntimeState with program seed (not Date.now() or random)
- [ ] VideoExporter creates RuntimeState with program seed
- [ ] GifExporter creates RuntimeState with program seed
- [ ] StandaloneExporter creates RuntimeState with program seed
- [ ] Confirm Math.random() in `pathLibrary/index.ts` is compile-time ID generation only
- [ ] Confirm Math.random() in `controlSurface/store.ts` comment documents PRNG usage (not actual usage)
- [ ] Document verification result: "Deterministic replay verified" OR create follow-up work item

---

## Work Item 3: Validate End-to-End Debug Probe Flow

**Task**: Trace through code to confirm complete debug probe data flow

### Acceptance Criteria

- [ ] DebugDisplay.ts calls `ctx.b.registerDebugProbe()` for each connected input (verified)
- [ ] IRBuilderImpl.ts collects probes in `builderIR.debugProbes` array (verified)
- [ ] StepDebugProbe type is included in StepIR discriminated union (verified)
- [ ] ScheduleExecutor.ts has `case "debugProbe"` that calls executeDebugProbe (verified)
- [ ] executeDebugProbe.ts reads slot values and writes to TraceController (verified)
- [ ] ProbeCard.tsx reads from TraceController OR create follow-up work item
- [ ] Document validation result: "End-to-end flow validated" OR list gaps with follow-up items

---

## Sprint Deliverables

This sprint delivers:
1. **Working test suite** - All TypeScript errors resolved, tests passing
2. **Verified deterministic replay** - Exporters confirmed to use seeded PRNG
3. **Validated debug flow** - Complete data flow confirmed OR gaps documented

**Deferred**:
- ProbeCard TraceController integration (if gap found - will be separate work item)
- Exporter PRNG fixes (if gaps found - will be separate work item)

---

## Overall Success Criteria

**Workstream Complete When**:
- [ ] `just typecheck` passes (no TypeScript errors)
- [ ] `just test` passes (all tests successful)
- [ ] `just check` passes (full validation suite)
- [ ] Deterministic replay verified OR follow-up created
- [ ] Debug probe flow validated OR follow-up created
- [ ] No regressions in existing features
- [ ] Workstream status updated to COMPLETE OR follow-up sprint scheduled

---

## Verification Checklist

**Before Marking Complete**:
- [ ] All acceptance criteria above are checked
- [ ] Test suite runs successfully end-to-end
- [ ] Any discovered gaps documented with follow-up work items
- [ ] Changes committed with clear commit message
- [ ] Workstream marked COMPLETE in .agent_planning/ directory

---

**Ready for /lp:impl** âœ…
