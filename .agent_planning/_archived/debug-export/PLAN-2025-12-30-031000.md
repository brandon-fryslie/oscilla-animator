# Debug + Export Workstream - Implementation Plan

**Generated**: 2025-12-30-031000
**Source**: STATUS-2025-12-30-030600.md
**Scope**: Workstream 7 - Debug + Export
**Total Effort**: 60-80 hours
**Current Status**: 40% complete (debug infrastructure exists, export not started)

---

## Executive Summary

This workstream delivers **complete debug and export capabilities** for Oscilla. Debug infrastructure exists but DebugDisplay IR lowering is blocked. Export pipeline does not exist.

**Critical Findings from STATUS**:
- âœ… Debug infrastructure COMPLETE (StepDebugProbe, executeDebugProbe, TraceController working)
- âŒ DebugDisplay IR lowering BLOCKED (explicitly throws error at line 34-39 of DebugDisplay.ts)
- âŒ Export pipeline MISSING (no export code exists)
- âš ï¸ Determinism PARTIAL (seeded PRNG exists but Math.random() used in 3 places)

**Strategy**: 8 focused sprints, each delivering 2-3 testable features. Start with foundation (debug IR + determinism), then build export pipeline incrementally.

---

## Sprint Organization

| Sprint | Focus | Deliverables | Effort | Priority |
|--------|-------|--------------|--------|----------|
| **1** | Foundation | DebugDisplay IR + Determinism + ProbeCard UI | 8-10h | P0 |
| **2** | Image Export | ImageSequenceExporter + Export UI + Tests | 10-14h | P0 |
| **3** | Signal Viz | SignalHistoryBuffer + SignalGraph + Integration | 8-12h | P1 |
| **4** | Video Export | VideoExporter + WebCodecs + Muxer | 14-18h | P0 |
| **5** | Field Viz | FieldStats + FieldHeatmap + Mode Selector | 10-12h | P1 |
| **6** | GIF Export | GIF Integration + Palette + Dithering | 6-8h | P1 |
| **7** | Standalone | HTML Template + Runtime Bundle + IR Serialization | 8-10h | P2 |
| **8** | Inspector | RuntimeSnapshot + RuntimeStateTree + Metadata | 6-8h | P2 |

**Total**: 70-92 hours (within 60-80 hour estimate accounting for parallelization)

---

## Sprint 1: Foundation - DebugDisplay IR + Determinism

**Goal**: Unblock IR debugging and ensure reproducible export
**Effort**: 8-10 hours
**Priority**: P0 (Critical - blocks all other work)

### Deliverable 1.1: DebugDisplay IR Lowering

**Status**: Blocked (currently throws error)
**Effort**: 3-4 hours
**Dependencies**: None (infrastructure exists)
**Spec Reference**: SPEC-11 (Debug Infrastructure) â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Area 2

#### Description
Replace error throw in `lowerDebugDisplay()` with proper IR emission. Map each connected input (signal/phase/domain/field) to StepDebugProbe with slot references. Integrate with existing TraceController infrastructure.

**Current Blocker** (from STATUS):
```typescript
// src/editor/compiler/blocks/debug/DebugDisplay.ts:33-39
const lowerDebugDisplay: BlockLowerFn = ({ ctx }) => {
  throw new Error(
    `DebugDisplay block (${ctx.instanceId}) cannot be lowered to IR yet.\n` +
    `Reason: DebugDisplay has side-effects (updates DebugStore)...`
  );
};
```

#### Acceptance Criteria
- [ ] `lowerDebugDisplay()` emits StepDebugProbe for each connected input (signal/phase/domain/field)
- [ ] Probe IDs assigned as `${instanceId}:${portId}` pattern
- [ ] StepDebugProbe.mode set to "value" for real-time display
- [ ] Test: Patch with Sine â†’ DebugDisplay compiles to IR without error
- [ ] Test: executeDebugProbe receives correct slot references from lowered DebugDisplay
- [ ] TypeScript compiles without errors

#### Technical Notes
- Infrastructure already exists: StepDebugProbe type (schedule.ts:682-710), executeDebugProbe (executeDebugProbe.ts:38-74), TraceController (125 lines)
- Pattern: Similar to how other blocks emit IR steps
- For each connected input port:
  1. Get ValueSlot from ctx (already allocated during lowering)
  2. Create DebugProbeIR with unique ID
  3. Emit StepDebugProbe referencing slot
- No need to touch DebugStore - keep legacy path separate

**Files to Modify**:
1. `src/editor/compiler/blocks/debug/DebugDisplay.ts` - Replace throw with IR emission
2. Create `src/editor/compiler/blocks/debug/__tests__/DebugDisplay.test.ts` - Integration test

---

### Deliverable 1.2: Deterministic Replay Verification

**Status**: Partial (PRNG exists, Math.random() in 3 places)
**Effort**: 2-3 hours
**Dependencies**: None
**Spec Reference**: SPEC-10 (Export) Â§ Determinism â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Area 4

#### Description
Audit and fix remaining Math.random() usage to guarantee bit-identical export output. Verify same seed produces identical frame sequence.

**From STATUS**: Math.random() found in:
1. `src/editor/pathLibrary/index.ts` - User path ID generation (OK - compile-time)
2. `src/editor/stores/DefaultSourceStore.ts` - Default source ID generation (OK - compile-time)
3. `src/editor/controlSurface/store.ts` - Random seed generation (NEEDS FIX - affects export)

#### Acceptance Criteria
- [ ] All runtime Math.random() usage replaced with seeded PRNG (core/rand.ts)
- [ ] controlSurface/store.ts uses explicit seed parameter instead of Math.random()
- [ ] Test: Same patch + seed â†’ bit-identical frame output (100 frames)
- [ ] Test: Different seeds â†’ different output (verify PRNG works)
- [ ] Documentation: Add comment explaining why compile-time Math.random() is OK

#### Technical Notes
- Seeded PRNG already exists: `src/core/rand.ts` Mulberry32 implementation
- Focus on controlSurface/store.ts - this affects rendering output
- ID generation randomness is compile-time, doesn't affect frame determinism
- Export config should include explicit seed parameter
- Determinism test should compare PNG bytes, not just pixel values

**Files to Modify**:
1. `src/editor/controlSurface/store.ts` - Replace Math.random() with seeded PRNG
2. Create `src/editor/export/__tests__/determinism.test.ts` - Replay verification test

---

### Deliverable 1.3: Connect DebugProbe to UI

**Status**: Gap (infrastructure works, UI not connected)
**Effort**: 3-4 hours
**Dependencies**: Deliverable 1.1 (DebugDisplay IR)
**Spec Reference**: SPEC-11 (Debug UI) â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Debug Data Flow

#### Description
Update ProbeCard component to read from TraceController instead of DebugStore. Enable IR-compiled patches to display debug values in UI.

**From STATUS**: "DebugProbe infrastructure works but UI is not connected to TraceController output."

#### Acceptance Criteria
- [ ] ProbeCard reads values from TraceController.getProbeValues(probeId)
- [ ] ProbeCard displays signal values from IR-compiled patches
- [ ] ProbeCard displays field samples (first 5 values) from IR-compiled patches
- [ ] Toggle in DebugHUD to enable/disable specific probes
- [ ] Test: End-to-end flow: Sine â†’ DebugDisplay (IR) â†’ TraceController â†’ ProbeCard UI
- [ ] Legacy DebugStore path continues to work (backward compatibility)

#### Technical Notes
- TraceController API already exists: mode switching, ring buffers, value encoding
- ProbeCard location: `src/editor/debug-ui/ProbeCard.tsx`
- Use MobX observable for reactive updates when TraceController writes new values
- May need to add observer pattern to TraceController or poll on frame
- Keep DebugStore path working for non-IR patches (closure compiler)

**Files to Modify**:
1. `src/editor/debug-ui/ProbeCard.tsx` - Add TraceController integration
2. `src/editor/debug/TraceController.ts` - Add getProbeValues() accessor if needed
3. `src/editor/debug-ui/__tests__/ProbeCard.test.tsx` - Test IR mode

---

## Sprint 2: Image Sequence Export

**Goal**: First working export feature, validates infrastructure
**Effort**: 10-14 hours
**Priority**: P0 (Critical - core user feature)

### Deliverable 2.1: ImageSequenceExporter Class

**Status**: Not Started
**Effort**: 6-8 hours
**Dependencies**: Sprint 1 (determinism)
**Spec Reference**: SPEC-10 Â§ Image Sequence Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Create ImageSequenceExporter class that renders frame sequence to OffscreenCanvas and exports as PNG/WebP blobs. Supports custom resolution, frame range, and progress callbacks.

**From SPEC-10**:
- OffscreenCanvas rendering at custom resolution
- Frame-by-frame rendering loop
- Blob conversion (PNG/WebP/JPEG)
- File naming pattern support
- Progress callback

#### Acceptance Criteria
- [ ] ImageSequenceExporter class exports frames as PNG blobs
- [ ] Supports custom resolution (width, height independent of viewport)
- [ ] Supports frame range (start frame, end frame, step)
- [ ] Supports format selection (PNG, WebP, JPEG with quality)
- [ ] Progress callback fires on each frame with (current, total, percentage)
- [ ] Cancellation support (cancel() method aborts export)
- [ ] Test: Export 60 frames at 1920x1080 produces 60 blobs
- [ ] Test: Export with step=2 produces half the frames
- [ ] Test: Cancellation stops export mid-sequence

#### Technical Notes
- Canvas2DRenderer.renderFrame() already exists and works (canvasRenderer.ts:189-234)
- Use OffscreenCanvas for rendering separate from viewport canvas
- Frame loop:
  1. Update player time: `t = startFrame / fps`
  2. Compile IR for frame (or use cached schedule)
  3. Execute schedule â†’ RenderFrameIR
  4. renderFrame(frameIR, valueStore) â†’ canvas pixels
  5. canvas.convertToBlob() â†’ PNG/WebP blob
  6. Yield blob to callback
- File naming pattern: `frame-{index:04d}.{ext}` (e.g., frame-0001.png)
- Consider File System Access API for direct save vs blob download

**Files to Create**:
1. `src/editor/export/ImageSequenceExporter.ts` - Main exporter class
2. `src/editor/export/types.ts` - Export config types
3. `src/editor/export/__tests__/ImageSequenceExporter.test.ts` - Unit tests

---

### Deliverable 2.2: Export UI and Controls

**Status**: Not Started
**Effort**: 4-6 hours
**Dependencies**: Deliverable 2.1
**Spec Reference**: SPEC-10 Â§ Export UI â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Ambiguity A2

#### Description
Create export dialog/panel with controls for format, resolution, frame range, and progress display. Integrate with ImageSequenceExporter.

**Ambiguity from STATUS**: Export UI integration point not decided. Recommend: File menu + dedicated export panel.

#### Acceptance Criteria
- [ ] Export dialog accessible from File menu â†’ "Export Image Sequence..."
- [ ] Controls: Resolution (width, height), Frame Range (start, end, step), Format (PNG/WebP/JPEG)
- [ ] Quality slider for JPEG/WebP (0-100)
- [ ] Progress bar shows export percentage
- [ ] Cancel button stops export mid-sequence
- [ ] Download button triggers file save (File System Access API or blob download)
- [ ] Test: User can export 30 frames at 720p as PNG
- [ ] Test: Cancel button stops export and cleans up resources

#### Technical Notes
- Use React for UI components
- Consider Radix UI or similar for dialog/modal
- Progress updates via callback from ImageSequenceExporter
- File System Access API for directory picker (Chrome/Edge) with fallback to zip download
- Store last-used settings in localStorage

**Files to Create**:
1. `src/editor/components/ExportDialog.tsx` - Main dialog component
2. `src/editor/components/ExportSettings.tsx` - Settings form
3. `src/editor/components/ExportProgress.tsx` - Progress bar component

---

### Deliverable 2.3: Image Export Tests

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 2.1, 2.2
**Spec Reference**: SPEC-10 Â§ Testing â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Test Suite Assessment

#### Description
Integration tests for image sequence export covering frame count, resolution, determinism, and error handling.

**From STATUS**: "Missing Tests: Image export determinism test - Same seed â†’ same PNG bytes"

#### Acceptance Criteria
- [ ] Test: Export 60 frames at 60fps produces 60 blobs (frame count validation)
- [ ] Test: Same seed produces bit-identical PNG bytes (determinism)
- [ ] Test: Different seeds produce different PNG bytes (PRNG validation)
- [ ] Test: Custom resolution (1920x1080) produces correct blob dimensions
- [ ] Test: Invalid frame range (start > end) throws error
- [ ] Test: Export with no frames (empty patch) handles gracefully
- [ ] Test: Cancellation cleans up OffscreenCanvas resources

#### Technical Notes
- Use vitest for test framework (existing setup)
- Mock player time and render loop for unit tests
- Use real Canvas2DRenderer for integration tests
- Compare PNG bytes for determinism (not just pixel values)
- Test error conditions: 0fps, negative frame range, out of memory

**Files to Create**:
1. `src/editor/export/__tests__/ImageSequenceExporter.test.ts` - Unit tests
2. `src/editor/export/__tests__/export-integration.test.ts` - Integration tests

---

## Sprint 3: Signal History Visualization

**Goal**: Real-time waveform visualization for debugging oscillating signals
**Effort**: 8-12 hours
**Priority**: P1 (High - key debug feature)

### Deliverable 3.1: SignalHistoryBuffer

**Status**: Not Started
**Effort**: 3-4 hours
**Dependencies**: Sprint 1 (TraceController working)
**Spec Reference**: SPEC-11 Â§ Signal History â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 2

#### Description
Ring buffer for storing time-series signal data. Integrates with TraceController to record signal values on each probe write.

**From STATUS**: "TraceController records values to ring buffers but no waveform visualization"

#### Acceptance Criteria
- [ ] SignalHistoryBuffer class stores time-series data (t, value) pairs
- [ ] Ring buffer with configurable size (default 1000 samples)
- [ ] Auto-scaling: track min/max for display bounds
- [ ] Sample rate management (assume 60fps, handle variable rates)
- [ ] addSample(t, value) method writes to buffer
- [ ] getSamples(count) returns most recent N samples
- [ ] Test: Buffer wraps correctly at capacity (sample 1001 overwrites sample 1)
- [ ] Test: Auto-scaling updates min/max on new extremes
- [ ] Test: getSamples(100) returns correct data

#### Technical Notes
- Similar to ValueRing (src/editor/debug/ValueRing.ts:156 lines) but for time-series
- Store (t, value) pairs in typed arrays for efficiency
- Track min/max for auto-scaling (no need to scan entire buffer)
- Consider storing derivative for velocity/acceleration visualization later

**Files to Create**:
1. `src/editor/debug/SignalHistoryBuffer.ts` - Ring buffer implementation
2. `src/editor/debug/__tests__/SignalHistoryBuffer.test.ts` - Unit tests

---

### Deliverable 3.2: SignalGraph Component

**Status**: Not Started
**Effort**: 4-6 hours
**Dependencies**: Deliverable 3.1
**Spec Reference**: SPEC-11 Â§ Signal Visualization â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 2

#### Description
Canvas-based waveform renderer for signal history. Displays time-series data with grid, axes, and auto-scaling.

#### Acceptance Criteria
- [ ] SignalGraph component renders waveform on canvas
- [ ] X-axis: time (seconds), Y-axis: value (auto-scaled)
- [ ] Grid rendering with time divisions (1s, 0.5s, 0.1s based on zoom)
- [ ] Crosshair on hover showing (t, value)
- [ ] Auto-scaling adjusts Y-axis bounds to fit min/max
- [ ] Test: Renders Sine wave as smooth curve
- [ ] Test: Auto-scaling updates when new extremes added
- [ ] Test: Grid divisions adjust based on time range

#### Technical Notes
- Use Canvas API for rendering (similar to FieldHeatmap later)
- Request animation frame for smooth updates
- Consider zoom/pan controls for longer histories
- Color code by signal type (scalar=blue, phase=green, etc.)

**Files to Create**:
1. `src/editor/debug-ui/SignalGraph.tsx` - Canvas waveform component
2. `src/editor/debug-ui/__tests__/SignalGraph.test.tsx` - Component tests

---

### Deliverable 3.3: Integration with Debug UI

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 3.1, 3.2
**Spec Reference**: SPEC-11 Â§ Debug UI Integration â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 2

#### Description
Add SignalGraph to DebugDrawer as new tab or enhancement to ProbeCard. Connect SignalHistoryBuffer to TraceController probe writes.

#### Acceptance Criteria
- [ ] SignalGraph tab in DebugDrawer shows all probed signals
- [ ] ProbeCard enhanced with "Show History" toggle
- [ ] TraceController.recordProbe() writes to SignalHistoryBuffer
- [ ] Graph updates in real-time as player advances
- [ ] Test: End-to-end flow: Sine â†’ DebugDisplay â†’ TraceController â†’ SignalGraph
- [ ] Test: Multiple signals displayed in separate graphs or overlaid

#### Technical Notes
- Add SignalHistoryBuffer to TraceController state
- Update executeDebugProbe to write to history buffer when mode != "off"
- Consider performance: limit history recording to specific probes (opt-in)
- UI location: Either new tab in DebugDrawer or toggle in ProbeCard

**Files to Modify**:
1. `src/editor/debug/TraceController.ts` - Add SignalHistoryBuffer integration
2. `src/editor/debug-ui/DebugDrawer.tsx` - Add SignalGraph tab/toggle
3. `src/editor/runtime/executor/steps/executeDebugProbe.ts` - Write to history buffer

---

## Sprint 4: Video Export

**Goal**: Video export with WebCodecs (H.264/VP9)
**Effort**: 14-18 hours
**Priority**: P0 (Critical - most requested export format)

### Deliverable 4.1: WebCodecs VideoEncoder Integration

**Status**: Not Started
**Effort**: 6-8 hours
**Dependencies**: Sprint 2 (ImageSequenceExporter working)
**Spec Reference**: SPEC-10 Â§ Video Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Integrate WebCodecs VideoEncoder API for real-time video encoding. Supports H.264 and VP9 codecs with configurable bitrate and quality.

**From STATUS**: "WebCodecs supports H.264, VP9, AV1 but browser support varies."
**Recommendation**: H.264 (default) + VP9 (advanced option)

#### Acceptance Criteria
- [ ] VideoExporter class uses WebCodecs VideoEncoder API
- [ ] H.264 codec support (baseline profile, level 4.0)
- [ ] VP9 codec support (fallback if H.264 not available)
- [ ] Browser support detection with graceful fallback to image sequence
- [ ] Bitrate configuration (default: 5 Mbps for 1080p)
- [ ] Quality configuration (CRF or constant bitrate mode)
- [ ] Test: Encode 60 frames to H.264 produces valid encoded chunks
- [ ] Test: Browser without WebCodecs falls back to image sequence
- [ ] Test: Codec config validation (invalid bitrate throws error)

#### Technical Notes
- WebCodecs API: `VideoEncoder.configure({ codec, width, height, bitrate })`
- Frame conversion: Canvas â†’ VideoFrame â†’ VideoEncoder.encode()
- Encoder output: EncodedVideoChunk â†’ muxer (next deliverable)
- Browser support: Chrome/Edge full, Firefox/Safari partial (2025)
- Codec strings: "avc1.42001f" (H.264 baseline), "vp09.00.10.08" (VP9)

**Files to Create**:
1. `src/editor/export/VideoExporter.ts` - VideoEncoder integration
2. `src/editor/export/codecs.ts` - Codec config utilities
3. `src/editor/export/__tests__/VideoExporter.test.ts` - Encoder tests

---

### Deliverable 4.2: Muxer Integration (MP4/WebM)

**Status**: Not Started
**Effort**: 4-6 hours
**Dependencies**: Deliverable 4.1
**Spec Reference**: SPEC-10 Â§ Video Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Dependencies

#### Description
Integrate muxing library (MP4Box.js or mp4-muxer) to package encoded video chunks into MP4/WebM container.

**From STATUS**: "Video muxing complexity - Use existing library (MP4Box.js or similar)"

#### Acceptance Criteria
- [ ] Muxer library integrated (mp4-muxer or MP4Box.js)
- [ ] MP4 container support for H.264 codec
- [ ] WebM container support for VP9 codec
- [ ] Muxer receives EncodedVideoChunk from VideoEncoder
- [ ] Final output: complete MP4/WebM blob ready for download
- [ ] Test: 60 encoded chunks â†’ valid MP4 file (playable in browser)
- [ ] Test: WebM muxing for VP9 codec
- [ ] Test: Invalid chunks (corrupted data) handled gracefully

#### Technical Notes
- Research: mp4-muxer (modern, lightweight) vs MP4Box.js (feature-rich, larger)
- Recommendation: mp4-muxer for simplicity and size
- Muxer input: EncodedVideoChunk from VideoEncoder output callback
- Muxer output: Blob or ArrayBuffer for download
- Consider audio support later (not in this sprint)

**Files to Create**:
1. `src/editor/export/muxer.ts` - Muxer abstraction layer
2. `src/editor/export/__tests__/muxer.test.ts` - Muxer tests
3. Add dependency: `mp4-muxer` (npm package)

---

### Deliverable 4.3: Video Export UI and Tests

**Status**: Not Started
**Effort**: 4-5 hours
**Dependencies**: Deliverable 4.1, 4.2
**Spec Reference**: SPEC-10 Â§ Export UI â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Ambiguity A4

#### Description
Add video export option to export dialog with codec selection, bitrate, and quality controls. Integration tests for end-to-end video export.

**From STATUS Ambiguity A4**: "Codec selection - Recommend H.264 (default) + VP9 (advanced option)"

#### Acceptance Criteria
- [ ] Export dialog includes "Export Video" option
- [ ] Codec selector: H.264 (default), VP9 (advanced)
- [ ] Bitrate slider (1-20 Mbps, default 5 Mbps)
- [ ] Quality mode: Constant Bitrate or CRF (if supported)
- [ ] Progress bar shows encoding progress
- [ ] Download button saves MP4/WebM file
- [ ] Test: Export 30 frames at 1080p H.264 produces playable MP4
- [ ] Test: VP9 export produces playable WebM
- [ ] Test: Unsupported codec shows error message

#### Technical Notes
- Extend ExportDialog from Sprint 2
- Add codec detection: `VideoEncoder.isConfigSupported({ codec })`
- Show codec availability in UI (checkmark or disabled state)
- Estimate file size based on bitrate and duration
- Consider audio export as future enhancement (not this sprint)

**Files to Modify**:
1. `src/editor/components/ExportDialog.tsx` - Add video export option
2. `src/editor/components/VideoExportSettings.tsx` - Codec/bitrate controls
3. `src/editor/export/__tests__/video-export.test.ts` - Integration tests

---

## Sprint 5: Field Visualization

**Goal**: Visual field inspection with heatmap and statistics
**Effort**: 10-12 hours
**Priority**: P1 (High - key debug feature)

### Deliverable 5.1: FieldStats Computation

**Status**: Not Started
**Effort**: 3-4 hours
**Dependencies**: Sprint 1 (TraceController working)
**Spec Reference**: SPEC-11 Â§ Field Visualization â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 3

#### Description
Compute field statistics (min, max, mean, stdDev) for visualization. Used by heatmap and histogram modes.

**From STATUS**: "ProbeCard displays field sample (first 5 values) as text" - need visual alternative

#### Acceptance Criteria
- [ ] computeFieldStats(fieldValues: Float32Array) returns { min, max, mean, stdDev }
- [ ] Handles empty fields gracefully (returns zero stats)
- [ ] Handles NaN/Inf values (filter or report)
- [ ] Efficient for large fields (1000+ elements)
- [ ] Test: Known distribution (0-1 uniform) produces correct stats
- [ ] Test: NaN values filtered or reported in stats
- [ ] Test: Large field (10000 elements) computes in <10ms

#### Technical Notes
- Single-pass algorithm for mean and variance (Welford's online algorithm)
- Consider WebGL compute shaders for very large fields (future optimization)
- Stats used for heatmap colormap scaling and histogram binning

**Files to Create**:
1. `src/editor/debug/FieldStats.ts` - Statistics computation
2. `src/editor/debug/__tests__/FieldStats.test.ts` - Unit tests

---

### Deliverable 5.2: FieldHeatmap Component

**Status**: Not Started
**Effort**: 5-6 hours
**Dependencies**: Deliverable 5.1
**Spec Reference**: SPEC-11 Â§ Field Visualization â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 3

#### Description
Canvas-based heatmap renderer for field values. Grid layout with colormap-mapped cells.

**From SPEC-11**: "Heatmap visualization (grid layout with colormap)"

#### Acceptance Criteria
- [ ] FieldHeatmap component renders field values as colored grid
- [ ] Colormap integration (use existing colormapLookup utilities)
- [ ] Grid dimensions: auto-detect or configurable (e.g., 10x10 for 100 elements)
- [ ] Color scaling based on field min/max (auto or manual)
- [ ] Hover shows (index, value) tooltip
- [ ] Test: 100-element field renders as 10x10 grid
- [ ] Test: Colormap maps minâ†’blue, maxâ†’red correctly
- [ ] Test: Hover tooltip displays correct value

#### Technical Notes
- Canvas rendering for performance
- Colormap location: `src/editor/utils/colormap.ts` or similar
- Grid layout: sqrt(N) x sqrt(N) or configurable rows/cols
- Consider virtualization for very large fields (>1000 elements)

**Files to Create**:
1. `src/editor/debug-ui/FieldHeatmap.tsx` - Heatmap component
2. `src/editor/debug-ui/__tests__/FieldHeatmap.test.tsx` - Component tests

---

### Deliverable 5.3: Mode Selector and Integration

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 5.1, 5.2
**Spec Reference**: SPEC-11 Â§ Field Visualization â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 3

#### Description
Add mode selector to ProbeCard for field visualization: text, heatmap, histogram.

**From SPEC-11**: "Mode selector (text | heatmap | histogram)"

#### Acceptance Criteria
- [ ] ProbeCard has mode selector for field probes (text/heatmap/histogram)
- [ ] Text mode: show first 5 values (existing behavior)
- [ ] Heatmap mode: show FieldHeatmap component
- [ ] Histogram mode: show distribution histogram (bins + counts)
- [ ] Mode persists per probe (localStorage or DebugStore)
- [ ] Test: Switch between modes updates display
- [ ] Test: Mode preference persists across page reload

#### Technical Notes
- Histogram implementation: bin field values by range, display as bar chart
- Use React state for mode selection
- Persist mode in localStorage: `debug.probe.${probeId}.mode`
- Consider adding stats panel showing min/max/mean/stdDev

**Files to Modify**:
1. `src/editor/debug-ui/ProbeCard.tsx` - Add mode selector
2. Create `src/editor/debug-ui/FieldHistogram.tsx` - Histogram component
3. `src/editor/debug-ui/__tests__/ProbeCard.test.tsx` - Test mode switching

---

## Sprint 6: GIF Export

**Goal**: Animated GIF export with palette optimization
**Effort**: 6-8 hours
**Priority**: P1 (High - social sharing use case)

### Deliverable 6.1: GIF Library Integration

**Status**: Not Started
**Effort**: 3-4 hours
**Dependencies**: Sprint 2 (ImageSequenceExporter)
**Spec Reference**: SPEC-10 Â§ GIF Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Integrate GIF encoding library (gif.js or modern-gif) with Web Worker support for background encoding.

**From SPEC-10**: "GIF library integration (gif.js or similar), Web worker support for encoding"

#### Acceptance Criteria
- [ ] GIF library integrated (gif.js or modern-gif)
- [ ] GifExporter class renders frames to GIF
- [ ] Web Worker encoding (off main thread)
- [ ] Frame delay configuration (ms per frame, based on fps)
- [ ] Loop configuration (infinite or N iterations)
- [ ] Test: 30 frames at 30fps produces looping GIF
- [ ] Test: Worker encoding doesn't block main thread
- [ ] Test: Frame delay matches configured fps

#### Technical Notes
- Research: gif.js (mature, Web Worker support) vs modern-gif (newer, smaller)
- GIF limitations: 256 colors max, no alpha (use background color)
- Frame delay: `1000 / fps` milliseconds per frame
- Worker encoding critical for 60+ frame sequences (main thread blocks)

**Files to Create**:
1. `src/editor/export/GifExporter.ts` - GIF exporter class
2. `src/editor/export/gif-worker.ts` - Web Worker for encoding
3. `src/editor/export/__tests__/GifExporter.test.ts` - Unit tests
4. Add dependency: `gif.js` or `modern-gif` (npm package)

---

### Deliverable 6.2: Palette Optimization and Dithering

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 6.1
**Spec Reference**: SPEC-10 Â§ GIF Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Add palette optimization and dithering options to improve GIF quality.

**From SPEC-10**: "Palette optimization, Dithering options"

#### Acceptance Criteria
- [ ] Palette optimization: analyze frames to build optimal 256-color palette
- [ ] Dithering modes: None, Floyd-Steinberg, Ordered
- [ ] Quality slider: controls palette size (16-256 colors)
- [ ] Test: Palette optimization reduces file size vs default palette
- [ ] Test: Dithering improves gradient quality
- [ ] Test: Quality slider affects color count in output

#### Technical Notes
- gif.js includes built-in palette optimization and dithering
- NeuQuant algorithm for palette quantization (included in gif.js)
- Dithering trades file size for visual quality
- Recommend Floyd-Steinberg dithering as default

**Files to Modify**:
1. `src/editor/export/GifExporter.ts` - Add palette/dithering config
2. `src/editor/export/__tests__/GifExporter.test.ts` - Test dithering modes

---

### Deliverable 6.3: GIF Export UI

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 6.1, 6.2
**Spec Reference**: SPEC-10 Â§ Export UI â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Add GIF export option to export dialog with quality, dithering, and loop controls.

#### Acceptance Criteria
- [ ] Export dialog includes "Export GIF" option
- [ ] Quality slider (16-256 colors, default 128)
- [ ] Dithering selector: None, Floyd-Steinberg, Ordered
- [ ] Loop mode: Infinite or N iterations
- [ ] FPS selector (10, 15, 24, 30, 60)
- [ ] Progress bar shows encoding progress
- [ ] Test: Export 15 frames at 15fps produces looping GIF
- [ ] Test: Quality slider affects output file size

#### Technical Notes
- Extend ExportDialog from Sprint 2/4
- Estimate file size: ~500KB per 30 frames at 512x512 (varies by content)
- Show encoding progress from Web Worker
- Consider max frame count warning (GIF >500 frames = large file)

**Files to Modify**:
1. `src/editor/components/ExportDialog.tsx` - Add GIF export option
2. `src/editor/components/GifExportSettings.tsx` - Quality/dithering controls
3. `src/editor/export/__tests__/gif-export.test.ts` - Integration tests

---

## Sprint 7: Standalone Player Export

**Goal**: Self-contained HTML export for sharing
**Effort**: 8-10 hours
**Priority**: P2 (Medium - nice-to-have for sharing)

### Deliverable 7.1: HTML Template Generation

**Status**: Not Started
**Effort**: 3-4 hours
**Dependencies**: Sprint 2 (export infrastructure)
**Spec Reference**: SPEC-10 Â§ Standalone Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Generate standalone HTML file with embedded runtime and animation. Playable in any browser without server.

**From SPEC-10**: "HTML template generation, Optional playback controls"

#### Acceptance Criteria
- [ ] StandaloneExporter generates self-contained HTML file
- [ ] HTML includes: runtime bundle, IR program, canvas rendering
- [ ] Playback controls: play/pause, scrub, loop toggle
- [ ] Responsive canvas (fits viewport)
- [ ] No external dependencies (all code inlined or CDN)
- [ ] Test: Generated HTML opens in browser and plays animation
- [ ] Test: HTML works offline (no network requests after load)
- [ ] Test: Playback controls functional (play/pause/scrub)

#### Technical Notes
- Template includes: minimal HTML, CSS, runtime bundle (JS), IR program (JSON)
- Runtime bundle: ScheduleExecutor, Canvas2DRenderer, ValueStore
- Consider using Vite build to bundle runtime separately
- Base64 encode assets if needed (fonts, textures)

**Files to Create**:
1. `src/editor/export/StandaloneExporter.ts` - HTML generator
2. `src/editor/export/templates/player.html` - HTML template
3. `src/editor/export/__tests__/StandaloneExporter.test.ts` - Generator tests

---

### Deliverable 7.2: Runtime Bundling Strategy

**Status**: Not Started
**Effort**: 3-4 hours
**Dependencies**: Deliverable 7.1
**Spec Reference**: SPEC-10 Â§ Standalone Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Bundle runtime code (executor, renderer) into standalone package. Choose between inline embedding or CDN hosting.

**From SPEC-10**: "Runtime bundling (inline or CDN)"

#### Acceptance Criteria
- [ ] Runtime bundle includes: ScheduleExecutor, Canvas2DRenderer, ValueStore, type definitions
- [ ] Bundle size optimized (<100KB minified+gzipped)
- [ ] Two modes: Inline (embed in HTML) or CDN (link to hosted bundle)
- [ ] Tree-shaking removes unused runtime code
- [ ] Test: Bundle includes all necessary runtime code
- [ ] Test: Inline mode embeds bundle in HTML
- [ ] Test: CDN mode links to external bundle URL

#### Technical Notes
- Use Vite library mode to bundle runtime separately
- Entry point: `src/runtime/standalone.ts` (exports executor, renderer, etc.)
- Minification + gzip target: <100KB
- CDN option: host on GitHub Pages or NPM CDN (unpkg, jsDelivr)
- Version bundle to allow cache invalidation

**Files to Create**:
1. `src/runtime/standalone.ts` - Runtime entry point
2. `vite.config.standalone.ts` - Vite config for runtime bundle
3. `src/editor/export/__tests__/bundle.test.ts` - Bundle size tests

---

### Deliverable 7.3: IR Serialization and Export UI

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 7.1, 7.2
**Spec Reference**: SPEC-10 Â§ Standalone Export â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 5

#### Description
Serialize IR program to JSON for embedding in standalone HTML. Add standalone export option to UI.

**From SPEC-10**: "IR program serialization"

#### Acceptance Criteria
- [ ] IR program serializes to JSON (Schedule, RenderFrameIR, metadata)
- [ ] Serialized IR includes all necessary data: slots, steps, passes, specs
- [ ] Deserialization in standalone player reconstructs runtime state
- [ ] Export dialog includes "Export Standalone Player" option
- [ ] Configuration: Inline or CDN mode, playback controls on/off
- [ ] Test: Serialized IR deserializes correctly in player
- [ ] Test: Export produces working standalone HTML

#### Technical Notes
- IR serialization: JSON.stringify(schedule) with type metadata
- Handle typed arrays: convert to regular arrays for JSON
- Standalone player: deserialize IR â†’ ScheduleExecutor.execute()
- UI: extend ExportDialog with standalone option

**Files to Modify**:
1. `src/editor/compiler/ir/serialize.ts` - IR serialization
2. `src/editor/export/StandaloneExporter.ts` - Use serialized IR
3. `src/editor/components/ExportDialog.tsx` - Add standalone option
4. `src/editor/export/__tests__/serialize.test.ts` - Serialization tests

---

## Sprint 8: Runtime State Inspector

**Goal**: Deep debugging tool for compiler/runtime internals
**Effort**: 6-8 hours
**Priority**: P2 (Medium - advanced debugging)

### Deliverable 8.1: Runtime Snapshot Capture

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Sprint 1 (debug infrastructure)
**Spec Reference**: SPEC-11 Â§ Runtime Inspector â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 4

#### Description
Capture complete runtime state snapshot: ValueStore slots, StateBuffer, metadata. Used for deep debugging of compiler output.

**From STATUS**: "No way to inspect ValueStore slots or StateBuffer"

#### Acceptance Criteria
- [ ] captureRuntimeSnapshot(runtime) returns snapshot object
- [ ] Snapshot includes: all ValueStore slots, StateBuffer state, metadata
- [ ] Slot metadata: type, value, source (which block allocated)
- [ ] StateBuffer metadata: operation state (e.g., integrator accumulator)
- [ ] Snapshot is serializable (JSON-compatible)
- [ ] Test: Snapshot captures all 100 slots in test runtime
- [ ] Test: Snapshot includes correct type metadata
- [ ] Test: Snapshot serializes to JSON without loss

#### Technical Notes
- ValueStore slots: Float32Array â†’ regular Array for JSON
- StateBuffer: map indices to operation names (e.g., "integrate:accum")
- Metadata: block instance ID, port name, type descriptor
- Snapshot size: ~1KB per 100 slots (manageable)

**Files to Create**:
1. `src/editor/debug/captureSnapshot.ts` - Snapshot function
2. `src/editor/debug/__tests__/captureSnapshot.test.ts` - Unit tests

---

### Deliverable 8.2: RuntimeStateTree UI Component

**Status**: Not Started
**Effort**: 3-4 hours
**Dependencies**: Deliverable 8.1
**Spec Reference**: SPEC-11 Â§ Runtime Inspector â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 4

#### Description
Tree UI component for browsing runtime state. Expandable tree with slots, state buffers, and metadata.

**From SPEC-11**: "RuntimeStateTree UI component"

#### Acceptance Criteria
- [ ] RuntimeStateTree component displays snapshot as expandable tree
- [ ] Tree nodes: ValueStore â†’ Slots â†’ Slot details
- [ ] Tree nodes: StateBuffer â†’ Operations â†’ State values
- [ ] Slot details: index, type, value, source block
- [ ] Search/filter slots by name or block ID
- [ ] Test: Tree expands/collapses nodes correctly
- [ ] Test: Search filters slots by name
- [ ] Test: Slot details display correct metadata

#### Technical Notes
- Use React tree component (e.g., react-arborist or custom)
- Tree structure:
  - RuntimeState
    - ValueStore (N slots)
      - Slot 0: type=float, value=1.23, source=sine:0
      - Slot 1: ...
    - StateBuffer (M operations)
      - integrate:0 (accum=0.5)
- Consider virtualization for large runtimes (1000+ slots)

**Files to Create**:
1. `src/editor/debug-ui/RuntimeStateTree.tsx` - Tree component
2. `src/editor/debug-ui/__tests__/RuntimeStateTree.test.tsx` - Component tests

---

### Deliverable 8.3: Inspector Integration and Testing

**Status**: Not Started
**Effort**: 2-3 hours
**Dependencies**: Deliverable 8.1, 8.2
**Spec Reference**: SPEC-11 Â§ Runtime Inspector â€¢ **Status Reference**: STATUS-2025-12-30-030600.md Â§ Gap 4

#### Description
Integrate RuntimeStateTree into DebugDrawer. Add snapshot capture trigger and tests.

#### Acceptance Criteria
- [ ] "Runtime State" tab in DebugDrawer
- [ ] "Capture Snapshot" button triggers captureRuntimeSnapshot()
- [ ] RuntimeStateTree displays captured snapshot
- [ ] Snapshot updates on each capture (not automatic)
- [ ] Test: End-to-end: compile patch â†’ execute â†’ capture â†’ display
- [ ] Test: Snapshot shows correct slot values from simple patch
- [ ] Test: State buffer values display correctly

#### Technical Notes
- Manual capture (not automatic) to avoid performance overhead
- Consider adding "Auto-capture on frame" toggle for advanced debugging
- Useful for debugging compiler bugs (wrong slot allocation, etc.)

**Files to Modify**:
1. `src/editor/debug-ui/DebugDrawer.tsx` - Add Runtime State tab
2. `src/editor/debug-ui/__tests__/DebugDrawer.test.tsx` - Integration test
3. `src/editor/runtime/executor/ScheduleExecutor.ts` - Add snapshot hook (optional)

---

## Dependency Graph

```
Sprint 1 (Foundation)
  â”œâ”€ 1.1 DebugDisplay IR
  â”œâ”€ 1.2 Deterministic Replay â”€â”€â”€â”€â”€â”€â”
  â””â”€ 1.3 Connect DebugProbe UI       â”‚
                                     â”‚
Sprint 2 (Image Export) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”œâ”€ 2.1 ImageSequenceExporter â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”
  â”œâ”€ 2.2 Export UI                   â”‚  â”‚
  â””â”€ 2.3 Image Tests                 â”‚  â”‚
                                     â”‚  â”‚
Sprint 3 (Signal Viz) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
  â”œâ”€ 3.1 SignalHistoryBuffer         â”‚â”‚  â”‚
  â”œâ”€ 3.2 SignalGraph                 â”‚â”‚  â”‚
  â””â”€ 3.3 Integration                 â”‚â”‚  â”‚
                                     â”‚â”‚  â”‚
Sprint 4 (Video Export) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
  â”œâ”€ 4.1 VideoEncoder                 â”‚  â”‚
  â”œâ”€ 4.2 Muxer                        â”‚  â”‚
  â””â”€ 4.3 Video UI + Tests             â”‚  â”‚
                                      â”‚  â”‚
Sprint 5 (Field Viz) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”œâ”€ 5.1 FieldStats                      â”‚
  â”œâ”€ 5.2 FieldHeatmap                    â”‚
  â””â”€ 5.3 Mode Selector                   â”‚
                                         â”‚
Sprint 6 (GIF Export) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”œâ”€ 6.1 GIF Library
  â”œâ”€ 6.2 Palette/Dithering
  â””â”€ 6.3 GIF UI

Sprint 7 (Standalone) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”œâ”€ 7.1 HTML Template                  â”‚
  â”œâ”€ 7.2 Runtime Bundling               â”‚
  â””â”€ 7.3 IR Serialization               â”‚
                                        â”‚
Sprint 8 (Inspector) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”œâ”€ 8.1 Snapshot Capture
  â”œâ”€ 8.2 RuntimeStateTree
  â””â”€ 8.3 Inspector Integration
```

**Critical Path**: Sprint 1 â†’ Sprint 2 â†’ Sprint 4
**Parallel Tracks**: Sprint 3, 5, 6, 7, 8 can proceed independently after Sprint 1

---

## Risk Assessment

| Risk | Severity | Likelihood | Sprint | Mitigation |
|------|----------|------------|--------|------------|
| **DebugDisplay IR integration breaks legacy** | HIGH | LOW | 1 | Keep legacy path separate, test both modes |
| **Math.random() usage missed in audit** | HIGH | MEDIUM | 1 | Grep codebase for Math.random(), manual review |
| **WebCodecs browser support insufficient** | MEDIUM | MEDIUM | 4 | Feature detection, fallback to image sequence |
| **Video muxing library choice wrong** | MEDIUM | LOW | 4 | Prototype both mp4-muxer and MP4Box.js first |
| **GIF file size too large** | LOW | MEDIUM | 6 | Document limits, recommend max 200 frames |
| **Standalone bundle size bloat** | LOW | LOW | 7 | Tree-shaking, measure bundle size in tests |
| **Field viz performance poor (>1000 elements)** | LOW | MEDIUM | 5 | Virtualization, WebGL fallback for large fields |

---

## Test Strategy

### Unit Tests (per deliverable)
- Isolated component/function testing
- Mock external dependencies (runtime, stores)
- Fast execution (<100ms per test)
- Coverage target: >80% for new code

### Integration Tests (per sprint)
- End-to-end user flows
- Real compiler + runtime (no mocks)
- Verify data flow across boundaries
- Example: Sine â†’ DebugDisplay â†’ TraceController â†’ ProbeCard UI

### Visual Tests (export features)
- Determinism: same seed â†’ same output bytes
- Frame count validation: 60 frames exported = 60 blobs
- Format validation: PNG/MP4/GIF playable in browser

### Performance Tests (where critical)
- Image export: 60 frames at 1080p in <10s
- Video encode: real-time or better (60fps encode at >60fps)
- GIF encode: background worker doesn't block UI
- Field stats: 10000 elements in <10ms

---

## Success Criteria

### Sprint 1 Success
- âœ… DebugDisplay works in IR mode (no error throw)
- âœ… Determinism test passes (same seed â†’ same frames)
- âœ… ProbeCard displays IR probe values

### Sprint 2 Success
- âœ… Image sequence export produces correct frame count
- âœ… Export UI functional with progress bar
- âœ… PNG export works at 1080p

### Sprint 4 Success
- âœ… Video export produces playable MP4/WebM
- âœ… H.264 and VP9 codecs working
- âœ… Export completes in reasonable time (<2x real-time)

### Overall Workstream Success
- âœ… All 4 export formats working (image, video, GIF, standalone)
- âœ… Debug UI shows signal history and field heatmaps
- âœ… Deterministic replay verified (export reproducible)
- âœ… Tests passing (>80% coverage for new code)
- âœ… No regressions in existing features

---

## Files Created/Modified Summary

### New Files (37 total)
**Sprint 1 (3 files)**:
- `src/editor/compiler/blocks/debug/__tests__/DebugDisplay.test.ts`
- `src/editor/export/__tests__/determinism.test.ts`
- `src/editor/debug-ui/__tests__/ProbeCard.test.tsx`

**Sprint 2 (6 files)**:
- `src/editor/export/ImageSequenceExporter.ts`
- `src/editor/export/types.ts`
- `src/editor/export/__tests__/ImageSequenceExporter.test.ts`
- `src/editor/components/ExportDialog.tsx`
- `src/editor/components/ExportSettings.tsx`
- `src/editor/components/ExportProgress.tsx`
- `src/editor/export/__tests__/export-integration.test.ts`

**Sprint 3 (5 files)**:
- `src/editor/debug/SignalHistoryBuffer.ts`
- `src/editor/debug/__tests__/SignalHistoryBuffer.test.ts`
- `src/editor/debug-ui/SignalGraph.tsx`
- `src/editor/debug-ui/__tests__/SignalGraph.test.tsx`
- (modify existing files)

**Sprint 4 (7 files)**:
- `src/editor/export/VideoExporter.ts`
- `src/editor/export/codecs.ts`
- `src/editor/export/__tests__/VideoExporter.test.ts`
- `src/editor/export/muxer.ts`
- `src/editor/export/__tests__/muxer.test.ts`
- `src/editor/components/VideoExportSettings.tsx`
- `src/editor/export/__tests__/video-export.test.ts`

**Sprint 5 (6 files)**:
- `src/editor/debug/FieldStats.ts`
- `src/editor/debug/__tests__/FieldStats.test.ts`
- `src/editor/debug-ui/FieldHeatmap.tsx`
- `src/editor/debug-ui/__tests__/FieldHeatmap.test.tsx`
- `src/editor/debug-ui/FieldHistogram.tsx`
- (modify existing files)

**Sprint 6 (4 files)**:
- `src/editor/export/GifExporter.ts`
- `src/editor/export/gif-worker.ts`
- `src/editor/export/__tests__/GifExporter.test.ts`
- `src/editor/components/GifExportSettings.tsx`
- `src/editor/export/__tests__/gif-export.test.ts`

**Sprint 7 (6 files)**:
- `src/editor/export/StandaloneExporter.ts`
- `src/editor/export/templates/player.html`
- `src/editor/export/__tests__/StandaloneExporter.test.ts`
- `src/runtime/standalone.ts`
- `vite.config.standalone.ts`
- `src/editor/export/__tests__/bundle.test.ts`
- `src/editor/compiler/ir/serialize.ts`
- `src/editor/export/__tests__/serialize.test.ts`

**Sprint 8 (6 files)**:
- `src/editor/debug/captureSnapshot.ts`
- `src/editor/debug/__tests__/captureSnapshot.test.ts`
- `src/editor/debug-ui/RuntimeStateTree.tsx`
- `src/editor/debug-ui/__tests__/RuntimeStateTree.test.tsx`
- (modify existing files)

### Modified Files (15 total)
- `src/editor/compiler/blocks/debug/DebugDisplay.ts` (Sprint 1)
- `src/editor/controlSurface/store.ts` (Sprint 1)
- `src/editor/debug-ui/ProbeCard.tsx` (Sprint 1, 5)
- `src/editor/debug/TraceController.ts` (Sprint 1, 3)
- `src/editor/components/ExportDialog.tsx` (Sprint 2, 4, 6, 7)
- `src/editor/debug-ui/DebugDrawer.tsx` (Sprint 3, 8)
- `src/editor/runtime/executor/steps/executeDebugProbe.ts` (Sprint 3)
- `src/editor/export/StandaloneExporter.ts` (Sprint 7)
- `src/editor/runtime/executor/ScheduleExecutor.ts` (Sprint 8)
- `src/editor/debug-ui/__tests__/DebugDrawer.test.tsx` (Sprint 8)

---

## Next Steps

1. **Review this plan** with project stakeholders
2. **Resolve ambiguities** from STATUS (A2: Export UI location, A4: Codec selection)
3. **Begin Sprint 1** (Foundation) - highest priority, unblocks everything else
4. **Iterate sprints** based on feedback and testing results

---

## Appendix: Specification References

- **SPEC-10**: Export Pipeline (design-docs/spec/10-export.md assumed)
- **SPEC-11**: Debug Infrastructure (design-docs/spec/11-debug.md assumed)
- **STATUS-2025-12-30-030600.md**: Current implementation status

---

**End of Plan** - Ready for implementation ðŸš€
