# Definition of Done: Sprint 2 - TypeWorld Unification

**Generated:** 2025-12-30-120000
**Plan:** PLAN-2025-12-30-SPRINT2.md
**Source STATUS:** STATUS-2025-12-30.md
**Scope:** Fix Issues #1, #4, #7 (TypeWorld vocabulary + transform chain detection)

---

## Acceptance Criteria

### Deliverable 1: Unify TypeWorld Vocabulary (Issues #1 & #7)

- [ ] IR TypeWorld enum (`src/editor/compiler/ir/types.ts:25`) includes `'config'` instead of `'special'`
- [ ] All `world: "special"` assignments in pass2-types.ts are changed to `world: "config"`
- [ ] Domain type has `world: 'config'` in both typeConversion.ts and pass2-types.ts (verified by grep)
- [ ] Full test suite passes (`just test`) with no regressions
- [ ] TypeScript compilation succeeds (`just typecheck`) with no new type errors

### Deliverable 2: Transform Chain Compile-Time Detection (Issue #4)

- [ ] Compile-time error is emitted when IR mode would create a transform chain (instead of runtime crash)
- [ ] Error message clearly states "Transform chains are not yet supported in IR mode"
- [ ] Test added that verifies compile error is emitted for transform chain creation
- [ ] Existing tests continue to pass (no transform chains are created in current compiler)
- [ ] Materializer.ts:1174 runtime error becomes unreachable code (documented with comment)

---

## Sprint Scope

### In Scope (2 deliverables max)

**Deliverable 1:** Replace `'special'` with `'config'` across ~20 files to unify TypeWorld vocabulary
**Deliverable 2:** Add compile-time error when transform chains would be created

### Out of Scope (Deferred)

**Transform Chain Execution:** Implementing `fillBufferTransform()` logic deferred to Sprint 4+ (Phase 6 per TODO comment)

**Type Conversion Design:** Holistic type conversion system design deferred to future sprint

---

## Verification Commands

```bash
# TypeScript compilation must succeed
just typecheck

# All tests must pass
just test

# No 'special' world references should remain
rg 'world.*"special"' --type ts src/editor/
rg '"special".*world' --type ts src/editor/

# Domain type should have 'config' in both files
rg "Domain.*world.*config" --type ts src/editor/compiler/passes/pass2-types.ts
rg "Domain.*world.*config" --type ts src/editor/ir/types/typeConversion.ts
```

---

## Files Modified (Expected)

### Deliverable 1
- `src/editor/compiler/ir/types.ts` (TypeWorld enum)
- `src/editor/compiler/passes/pass2-types.ts` (type mappings)
- ~18 additional files (search-replace `world: "special"` â†’ `world: "config"`)

### Deliverable 2
- `src/editor/compiler/passes/pass2-types.ts` (detection logic)
- `src/editor/compiler/types.ts` (error code)
- Test file (new or modified)
- `src/editor/runtime/field/Materializer.ts` (unreachable comment)

---

## Success Criteria

Sprint 2 is 100% complete when:

1. All 10 acceptance criteria above are checked
2. `just check` passes (typecheck + lint + test)
3. Grep verification shows no `world: "special"` in TypeWorld context
4. Transform chain creation emits compile error (verified by test)
5. Issues #1, #4, #7 can be marked FIXED in next STATUS file

---

## Post-Sprint Actions

- [ ] Create STATUS-2025-12-30-SPRINT2.md marking issues FIXED
- [ ] Clean up old PLAN/DOD files (keep last 4, archive rest)
- [ ] Update HANDOFF.md noting transform execution deferred to Phase 6
- [ ] Evaluate if more red flags remain for Sprint 3
