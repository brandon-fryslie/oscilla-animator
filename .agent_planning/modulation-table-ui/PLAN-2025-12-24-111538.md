# Sprint Plan: Modulation Table Responsive Layout
Generated: 2025-12-24-111538
Source: STATUS-responsive-20251224-155100.md
Confidence: FRESH
Effort: LOW (< 30 minutes)
Risk: LOW (CSS-only changes)

---

## Executive Summary

**Current State:** Modulation table works but fails to fill its container, leaving 39% empty space (340px table in 559px container).

**Root Cause:** Fixed pixel widths in CSS instead of responsive percentage-based layout.

**Solution:** 4 targeted CSS changes to make table fill container while preserving sticky columns, horizontal scroll, and dynamic column counts.

**Sprint Goal:** Make modulation table responsive - fills container at any width, works with resizable panels, scrolls horizontally when needed.

**Deliverables:**
1. Table fills container at all widths
2. Works with panel resizer (drag to resize)
3. Handles varying column counts (6-26+ columns)
4. Preserves horizontal scroll on overflow

**No React/TypeScript changes required** - CSS-only fix.

---

## Gap Analysis

### STATUS Evidence Summary

**From STATUS-responsive-20251224-155100.md:**

**Container Hierarchy (Lines 20-28):**
```
.modulation-table-container: 1125px
  └─ .mod-table-sections: 1125px
       ├─ .listeners-section: 559.5px (50% split) ✓ RESPONSIVE
       │    └─ .modulation-table: 340px ❌ FIXED SIZE
       └─ .publishers-section: 559.5px (50% split) ✓ RESPONSIVE
            └─ .modulation-table: 340px ❌ FIXED SIZE
```

**CSS Issues (Lines 40-46):**
- `.mod-table-corner`: `width: 100px` (hardcoded)
- `.mod-table-col-header.compact`: `width: 40px` (hardcoded)
- `.mod-table-col-header.expanded`: `width: 90px` (hardcoded)
- `.modulation-table`: Missing `width: 100%`

**Calculation:**
- 6 columns × 40px + 100px corner = 340px table
- Container: 559.5px available
- Wasted: 219.5px (39% empty space)

### Specification Requirements

**From CLAUDE.md (07-UI-Spec.md implied):**
- Table shows bus listeners/publishers
- Resizable split between sections
- Sticky row headers (first column)
- Horizontal scroll when many columns
- Dynamic column count (default 6 buses, user can add more)

### Gaps

| Requirement | Current State | Gap |
|-------------|---------------|-----|
| Fill container | Fixed 340px | Missing `width: 100%` |
| Responsive columns | Fixed 40px/90px | Need percentage-based |
| Responsive corner | Fixed 100px | Need percentage with min/max |
| Works with resize | Container resizes, table doesn't | Table needs to follow container |
| Many columns scroll | Works ✓ | No gap |
| Sticky row headers | Works ✓ | No gap |

---

## Work Items

### P0: Make Table Fill Container (CRITICAL)

**Status**: Not Started
**Effort**: Small (5 minutes)
**Dependencies**: None
**Spec Reference**: 07-UI-Spec.md (implied) • **Status Reference**: STATUS-responsive-20251224-155100.md lines 66-78, 373-380

#### Description
Add `width: 100%` to `.modulation-table` class to force table to fill its container. Currently table shrinks to content width (340px) leaving empty space.

**Root Cause:** CSS `table-layout: fixed` without `width: 100%` causes table to shrink to minimum content width.

**Fix Location:** `src/editor/modulation-table/ModulationTable.css` line 220

#### Acceptance Criteria (REQUIRED)
- [ ] `.modulation-table` has `width: 100%` declaration
- [ ] Table width measured in DevTools equals section width (within 1px)
- [ ] No horizontal gap between table and section border
- [ ] Table still uses `table-layout: fixed` (required for sticky columns)

#### Technical Notes
This is the foundational fix - without this, percentage column widths won't work. Keep `table-layout: fixed` for sticky column behavior.

---

### P0: Make Corner Cell Responsive (CRITICAL)

**Status**: Not Started
**Effort**: Small (5 minutes)
**Dependencies**: P0 (Make Table Fill Container)
**Spec Reference**: 07-UI-Spec.md (sticky columns) • **Status Reference**: STATUS-responsive-20251224-155100.md lines 152-158, 381-395

#### Description
Convert `.mod-table-corner` from fixed 100px to percentage-based width with min/max constraints. This cell defines the width of the sticky row header column.

**Current:** `width: 100px` (rigid)
**Target:** `width: 20%; min-width: 80px; max-width: 150px;` (flexible)

**Fix Location:** `src/editor/modulation-table/ModulationTable.css` line 230

#### Acceptance Criteria (REQUIRED)
- [ ] Corner cell uses percentage width (20%)
- [ ] Has `min-width: 80px` to prevent collapse on narrow containers
- [ ] Has `max-width: 150px` to prevent expansion on ultrawide monitors
- [ ] At 559px container: corner cell ~112px (20% of 559px)
- [ ] Sticky behavior still works (positioned at left: 0, z-index: 3)

#### Technical Notes
The 20% allocation leaves 80% for column headers to auto-distribute. With `table-layout: fixed`, first row `<th>` widths define all column widths.

---

### P1: Remove Compact Column Fixed Width (HIGH)

**Status**: Not Started
**Effort**: Small (5 minutes)
**Dependencies**: P0 (Make Table Fill Container, Make Corner Cell Responsive)
**Spec Reference**: 07-UI-Spec.md (column expand/collapse) • **Status Reference**: STATUS-responsive-20251224-155100.md lines 160-164, 396-403

#### Description
Remove fixed `width: 40px` from `.mod-table-col-header.compact` and replace with `min-width: 32px`. Let browser auto-distribute remaining 80% of table width across columns.

**Current:** `width: 40px` (rigid)
**Target:** `min-width: 32px` (flexible, auto-distributed)

**Fix Location:** `src/editor/modulation-table/ModulationTable.css` line 248

#### Acceptance Criteria (REQUIRED)
- [ ] `.mod-table-col-header.compact` has `min-width: 32px` (not `width`)
- [ ] No explicit `width` declaration (let browser calculate)
- [ ] With 6 columns at 559px container: each column ~75px ((559 × 0.8) / 6)
- [ ] With 10 columns at 559px: each column ~45px ((559 × 0.8) / 10)
- [ ] Columns stay aligned across all rows (table-layout: fixed guarantees this)

#### Technical Notes
**How auto-distribution works with `table-layout: fixed`:**
1. Table width: 100% of container (559px)
2. Corner cell: 20% = 112px
3. Remaining: 80% = 447px
4. 6 columns: 447px / 6 = 74.5px each
5. 10 columns: 447px / 10 = 44.7px each

Browser calculates per-column width automatically.

---

### P1: Make Expanded Column Responsive (HIGH)

**Status**: Not Started
**Effort**: Small (5 minutes)
**Dependencies**: P0 (Make Table Fill Container, Make Corner Cell Responsive)
**Spec Reference**: 07-UI-Spec.md (column expand toggle) • **Status Reference**: STATUS-responsive-20251224-155100.md lines 166-170, 404-411

#### Description
Replace fixed `width: 90px` for expanded columns with relative sizing that's wider than compact but still flexible.

**Current:** `width: 90px` (rigid)
**Target:** `width: 2.5%; min-width: 70px;` (flexible, wider than auto)

**Fix Location:** `src/editor/modulation-table/ModulationTable.css` line 254

#### Acceptance Criteria (REQUIRED)
- [ ] `.mod-table-col-header.expanded` uses percentage width (2.5%)
- [ ] Has `min-width: 70px` to prevent collapse
- [ ] Expanded column visibly wider than compact columns
- [ ] Click column header to expand → column grows
- [ ] Table still fills container after expansion
- [ ] Other columns shrink proportionally to make room

#### Technical Notes
**Why 2.5%?**
- Auto-distributed compact column at 559px: ~75px (1.5% effective)
- Expanded at 2.5%: ~100px (1.67× wider)
- Still flexible, not rigid

**Behavior:**
- User clicks column header → adds `.expanded` class
- Expanded column requests 2.5% of table width
- Compact columns share remaining space equally
- Table still 100% of container

---

### P2: Update Mobile Media Query (MEDIUM)

**Status**: Not Started
**Effort**: Small (10 minutes)
**Dependencies**: All P0/P1 items
**Spec Reference**: 07-UI-Spec.md (responsive) • **Status Reference**: STATUS-responsive-20251224-155100.md lines 412-427

#### Description
Update existing `@media (max-width: 768px)` to use percentage widths instead of smaller pixel values. Current media query adjusts from 100px→80px, 40px→32px but doesn't fix core responsiveness.

**Fix Location:** `src/editor/modulation-table/ModulationTable.css` lines 1350-1371

#### Acceptance Criteria (REQUIRED)
- [ ] Mobile media query uses percentage for corner cell (25%)
- [ ] Mobile corner min-width: 60px (narrower than desktop 80px)
- [ ] Mobile compact column min-width: 24px (narrower than desktop 32px)
- [ ] Test on 375px viewport: table fills width, columns readable
- [ ] Horizontal scroll appears if needed

#### Technical Notes
**Mobile-specific adjustments:**
- Narrower corner: 25% (vs 20% desktop) to give columns more room
- Lower min-widths to prevent early overflow
- Still use percentage-based approach

**Typical mobile calculation (375px width):**
- Corner: 25% = 94px
- Remaining: 75% = 281px
- 6 columns: 281px / 6 = 47px each (readable)

---

## Dependency Graph

```
P0: Make Table Fill Container
  ├─→ P0: Make Corner Cell Responsive
  │     ├─→ P1: Remove Compact Column Fixed Width
  │     └─→ P1: Make Expanded Column Responsive
  └─→ P2: Update Mobile Media Query (after all P0/P1 complete)
```

**Implementation Order:**
1. Add `width: 100%` to table (enables percentages)
2. Convert corner to percentage (defines row header width)
3. Remove compact column width (enables auto-distribution)
4. Add expanded column percentage (wider variant)
5. Update media query (mobile optimization)

---

## Recommended Sprint Planning

### Sprint 1: Core Responsive Fixes (15-20 minutes)

**Goal:** Table fills container at all widths

**Items:**
- P0: Make Table Fill Container
- P0: Make Corner Cell Responsive
- P1: Remove Compact Column Fixed Width
- P1: Make Expanded Column Responsive

**Testing:**
1. Measure table vs container width (should be equal)
2. Drag resizer left/right (table should follow)
3. Add buses to increase columns (should auto-distribute)
4. Click column header to expand (should grow smoothly)

**Definition of Done:** Table fills container, resize works, columns flexible.

### Sprint 2: Mobile Polish (10 minutes)

**Goal:** Optimize for small screens

**Items:**
- P2: Update Mobile Media Query

**Testing:**
1. Resize viewport to 375px
2. Verify table fills width
3. Check column readability
4. Test horizontal scroll with many columns

**Definition of Done:** Mobile viewport works smoothly.

---

## Risk Assessment

### LOW RISK
All changes are isolated to CSS, no React/TypeScript modifications.

**What could go wrong:**
1. **Percentage widths look odd with very few columns**
   - Mitigation: min-width prevents expansion beyond readable size
   - 1 column gets 80% width → still functional, just wider than needed

2. **Sticky columns break**
   - Mitigation: Not changing `position: sticky` or z-index
   - Table-layout: fixed preserves width inheritance

3. **Tooltips misaligned**
   - Mitigation: Tooltip positioning uses DOM rect, not CSS widths
   - Should adapt automatically

4. **Horizontal scroll triggers too early**
   - Mitigation: min-width values prevent premature collapse
   - Test with 20+ columns to verify

**No high-risk items identified.**

---

## Chrome DevTools Test Plan

**CRITICAL:** User requested visual verification instead of unit tests.

### Test 1: Table Fills Container (50% Split)
**Setup:** Load app, switch to Table view
**Action:** Measure table width in DevTools
**Expected:** `.modulation-table` width === `.listeners-section` width (559.5px ±1px)
**Verify:** No horizontal gap visible

### Test 2: Drag Resizer
**Setup:** Default 50/50 split
**Action:** Drag center resizer to ~70/30 split
**Expected:** Left table fills ~780px section, right table fills ~340px section
**Verify:** Both tables fill their containers

### Test 3: Add Columns (More Buses)
**Setup:** Default 6 columns
**Action:** Add 4 custom buses (total 10 columns)
**Expected:** Columns narrower (~45px each), table still fills container
**Verify:** No horizontal scroll (10 × 45px + 112px corner = ~562px fits in 559px)

### Test 4: Many Columns (Overflow)
**Setup:** Default 6 columns
**Action:** Add 20 custom buses (total 26 columns)
**Expected:** Horizontal scroll appears, can scroll to see all columns
**Verify:** `.section-table-scroll` has scrollbar, scroll works smoothly

### Test 5: Collapse Section
**Setup:** Default 50/50 split
**Action:** Click "Collapse" on listeners section
**Expected:** Publishers section expands to full width, table fills expanded section
**Verify:** Table width === full container width (~1125px)

### Test 6: Expand Column
**Setup:** Default compact columns
**Action:** Click "phaseA" column header to expand
**Expected:** phaseA column wider (~100px), other columns narrower (~70px), table still fills container
**Verify:** Total width === container width

### Test 7: Mobile Viewport
**Setup:** Resize viewport to 375px width
**Action:** Measure table and column widths
**Expected:** Table fills 375px, corner ~94px, 6 columns ~47px each
**Verify:** Text readable, no excessive wrapping

---

## Implementation Checklist

### Pre-Implementation
- [ ] Read STATUS-responsive-20251224-155100.md completely
- [ ] Review `src/editor/modulation-table/ModulationTable.css` lines 220-260
- [ ] Review media query at lines 1350-1371
- [ ] Open Chrome DevTools, measure current table width (should be 340px)

### Implementation (CSS Changes)
- [ ] Line 220: Add `width: 100%;` to `.modulation-table`
- [ ] Line 230: Change `.mod-table-corner` to `width: 20%; min-width: 80px; max-width: 150px;`
- [ ] Line 248: Change `.mod-table-col-header.compact` to `min-width: 32px;` (remove `width: 40px;`)
- [ ] Line 254: Change `.mod-table-col-header.expanded` to `width: 2.5%; min-width: 70px;` (remove `width: 90px;`)
- [ ] Lines 1350-1371: Update media query corner to `width: 25%; min-width: 60px;`
- [ ] Lines 1350-1371: Update media query compact to `min-width: 24px;`

### Testing (Chrome DevTools)
- [ ] Run Test 1: Table Fills Container
- [ ] Run Test 2: Drag Resizer
- [ ] Run Test 3: Add Columns
- [ ] Run Test 4: Many Columns
- [ ] Run Test 5: Collapse Section
- [ ] Run Test 6: Expand Column
- [ ] Run Test 7: Mobile Viewport

### Verification
- [ ] No TypeScript errors (`just typecheck`)
- [ ] No linting errors (`just lint`)
- [ ] All 7 DevTools tests pass
- [ ] No visual regressions (sticky headers, tooltips work)

---

## Quality Standards

### Code Quality
- **Minimal change:** Only CSS, no structural changes
- **Preserves behavior:** Sticky columns, horizontal scroll, expand/collapse
- **Responsive:** Works at any container width
- **Mobile-optimized:** Readable at 375px viewport

### Testing Quality
- **Visual verification:** Chrome DevTools measurements
- **Interactive testing:** Drag resizer, add columns, expand headers
- **Edge cases:** Empty table, 1 column, 26+ columns, ultrawide/mobile

### Documentation Quality
- **Inline comments:** Document why percentages chosen (20%, 2.5%)
- **Git commit:** Reference issue, explain responsive approach

---

## Edge Cases

### Empty Table
**STATUS Reference:** Lines 273-274
**Current:** `.section-empty` shows "No listeners/publishers" message
**Impact:** N/A - empty state handled separately
**Action:** No changes needed

### Single Column
**STATUS Reference:** Lines 276-279
**Current:** No special handling
**Impact:** Column gets 80% width (~447px at 559px container)
**Mitigation:** `max-width: 150px` on corner prevents excessive width
**Action:** Functional, no changes needed (edge case acceptable)

### Many Columns (20+)
**STATUS Reference:** Lines 281-284
**Current:** Horizontal scroll works via `.section-table-scroll { overflow: auto }`
**Impact:** None - overflow behavior correct
**Action:** No changes needed

### Very Wide Container (Ultrawide Monitor)
**STATUS Reference:** Lines 286-290
**Current:** No max-width on table
**Impact:** Columns expand proportionally
**Mitigation:** `max-width: 150px` on corner prevents excessive corner width
**Action:** Acceptable - expanded columns can grow, compact columns auto-distribute

### Very Narrow Container (Mobile)
**STATUS Reference:** Lines 292-295
**Current:** Media query exists but uses fixed widths
**Impact:** Table doesn't fill container on mobile
**Action:** P2 work item addresses this

---

## Workflow Recommendation

**CONTINUE** - All issues clear, solution identified, no blockers.

**No clarification needed:**
- [x] Requirements understood (fill container, responsive, scroll on overflow)
- [x] Root cause identified (fixed pixel widths)
- [x] Solution specified (percentage widths with min/max)
- [x] Testing approach defined (Chrome DevTools visual verification)

**Implementer should:**
1. Apply 4 CSS changes in order (table → corner → compact → expanded)
2. Test after each change in Chrome DevTools
3. Verify with varying column counts (6, 10, 20+)
4. Test panel resizing (drag center resizer)
5. Check mobile breakpoint (375px viewport)
6. Commit with message: "Make modulation table responsive - fills container at all widths"

---

## Summary for Next Agent

**What works:**
- Container resizing (sections split properly with draggable resizer)
- Horizontal scroll (appears when table exceeds container)
- Sticky row headers (first column stays visible)
- Column expand/collapse toggle (compact/expanded classes)

**What's broken:**
- Table uses fixed pixel widths (340px), doesn't fill container (559px)
- Leaves 219.5px empty space (39% wasted)

**Fix:**
- Add `width: 100%` to `.modulation-table`
- Change corner cell to `width: 20%; min-width: 80px; max-width: 150px;`
- Remove fixed widths from compact columns, add `min-width: 32px`
- Change expanded columns to `width: 2.5%; min-width: 70px;`

**Effort:** 15-30 minutes
**Risk:** LOW (CSS-only change, no React/TS modifications)
**Testing:** Chrome DevTools visual verification (7 test scenarios)

**Files to modify:**
- `src/editor/modulation-table/ModulationTable.css` (lines 220, 230, 248, 254, 1350-1371)

**No blockers, no ambiguities, ready to implement.**
