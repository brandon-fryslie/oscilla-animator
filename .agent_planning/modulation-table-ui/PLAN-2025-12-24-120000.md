# Sprint Plan: Replace ModulationTable with MUI DataGrid
Generated: 2025-12-24-120000 (Revised)

## Sprint Goal
Replace the broken HTML table implementation with Material UI DataGrid, preserving ALL existing functionality.

## Context
The current HTML `<table>` implementation has unfixable layout issues:
- Clicking cells causes columns to resize (45px → 134px)
- `table-layout: fixed` doesn't prevent cell content from affecting column widths
- Multiple CSS fix attempts have failed

## Scope
**All features included in this sprint:**
1. Install MUI dependencies
2. Implement ModulationTableGrid with DataGrid
3. Column expand/collapse on header click
4. Cell interactions (click, focus, binding display)
5. Existing toolbar features (search, "Bound only", "Compatible only" filters)
6. Sticky headers (row and column)
7. Tooltips on headers only (NO cell tooltips)
8. Side-by-side Listeners/Publishers layout with resizer
9. Section collapse/expand
10. Dark theme styling
11. Responsive layout (fills container)

## Work Items

### P0: Install MUI Dependencies
**Acceptance Criteria:**
- [ ] @mui/material installed
- [ ] @mui/x-data-grid installed
- [ ] @emotion/react and @emotion/styled installed (MUI peer deps)
- [ ] `just typecheck` passes
- [ ] `just lint` passes

**Technical Notes:**
```bash
pnpm add @mui/material @mui/x-data-grid @emotion/react @emotion/styled
```

### P1: Create MUI Theme Provider
**Acceptance Criteria:**
- [ ] MUI ThemeProvider wrapping modulation table
- [ ] Dark theme colors match existing app palette
- [ ] DataGrid inherits dark theme

**Technical Notes:**
- Create theme in ModulationTable.tsx or dedicated theme file
- Match CSS variables: --bg-primary, --bg-secondary, --text-primary, etc.

### P2: Create ModulationTableGrid Component
**Acceptance Criteria:**
- [ ] New ModulationTableGrid.tsx component using DataGrid
- [ ] Rows display block inputs/outputs with label and type (stacked)
- [ ] Columns display buses with icons/abbreviations
- [ ] Cells show binding status (● bound, ~ convertible, × incompatible)
- [ ] Cell click triggers onCellClick callback
- [ ] **CRITICAL: Column widths remain stable when clicking cells**
- [ ] Table fills container width (responsive)
- [ ] Sticky row headers (first column)
- [ ] Sticky column headers (top row)

**Technical Notes:**
- Use DataGrid's `columns` prop with `flex` values for responsive sizing
- First column (row header) pinned with `pinnedColumns`
- Map existing `TableRow` and `TableColumn` data to DataGrid format

### P3: Column Expand/Collapse Feature
**Acceptance Criteria:**
- [ ] Click column header → column expands (shows full name, type, publisher count)
- [ ] Click expanded header → column collapses (shows icon/abbreviation)
- [ ] Expanded column wider than compact columns
- [ ] Other columns adjust proportionally
- [ ] Table still fills container after expand/collapse

**Technical Notes:**
- Track expanded column IDs in component state
- Use dynamic column width based on expanded state
- Custom header renderer for expand/collapse behavior

### P4: Toolbar and Filtering
**Acceptance Criteria:**
- [ ] Search input filters rows by label
- [ ] "Bound only" checkbox shows only rows with bindings
- [ ] "Compatible only" checkbox shows only compatible cells/rows
- [ ] Filters work together (AND logic)
- [ ] Filter state preserved in ModulationTableStore

**Technical Notes:**
- Reuse existing toolbar component
- DataGrid's `filterModel` or custom row filtering via props

### P5: Header Tooltips (Headers Only - NO Cell Tooltips)
**Acceptance Criteria:**
- [ ] Column header hover shows bus name, type, publisher count
- [ ] Row header hover shows block type, port details
- [ ] NO tooltips on data cells
- [ ] Tooltips styled with dark theme

**Technical Notes:**
- Use custom header renderer with Tippy.js or MUI Tooltip
- Data cells have NO tooltip handlers

### P6: Section Integration
**Acceptance Criteria:**
- [ ] Listeners section renders ModulationTableGrid
- [ ] Publishers section renders ModulationTableGrid
- [ ] Side-by-side layout with draggable resizer works
- [ ] Section collapse button hides section, other expands
- [ ] Section headers clickable to collapse

**Technical Notes:**
- Keep existing section layout components
- Replace only the table portion with DataGrid

### P7: Cleanup
**Acceptance Criteria:**
- [ ] Remove old HTML table rendering code
- [ ] Remove obsolete CSS table styles
- [ ] Update component exports if needed
- [ ] No dead code remaining

## Dependencies
- MUI packages must be compatible with React 19
- Existing ModulationTableStore interface preserved (no changes)

## Risks
| Risk | Mitigation |
|------|------------|
| MUI + React 19 compatibility | Check MUI docs, test immediately after install |
| Bundle size increase | MUI tree-shakes well; acceptable tradeoff for stability |
| Styling conflicts | Use MUI theme, scoped styles |

## Files to Modify/Create
- `package.json` - add dependencies
- `src/editor/modulation-table/ModulationTableGrid.tsx` - NEW (main grid component)
- `src/editor/modulation-table/muiTheme.ts` - NEW (dark theme config)
- `src/editor/modulation-table/ModulationTable.tsx` - integrate new component
- `src/editor/modulation-table/ModulationTable.css` - remove table styles, keep layout
