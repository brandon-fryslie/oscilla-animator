# IR and Schedule Visualizer

## Summary

Add visual graphic representations of the compiled IR (Intermediate Representation) and execution Schedule to the debug tools. This includes:
1. New tabs in the DebugDrawer UI for IR and Schedule visualization
2. REPL commands (`ir`, `schedule`) for text-based inspection
3. Tree/graph visualizations showing the structure

## Context

The current debug infrastructure has:
- **DebugDrawer** (`src/editor/debug-ui/DebugDrawer.tsx`): Slide-up panel with tabs (Overview, Buses)
- **DebugStore** (`src/editor/stores/DebugStore.ts`): REPL console with commands
- **CompileResult** (`src/editor/compiler/types.ts`): Contains `programIR` and `ir` fields

The IR and Schedule are accessible via `compilerService.getLatestResult()` but have no visual representation.

## Architecture

### Data Sources

From `CompileResult`:
- `programIR: CompiledProgramIR` - Full compiled IR
  - `nodeTable` - Block nodes
  - `busTable` - Bus definitions
  - `schedule.steps` - Execution schedule steps
  - `timeModel` - Time topology
- `ir: LinkedGraphIR` - Intermediate graph representation

### New Components

1. **IRTab** (`src/editor/debug-ui/IRTab.tsx`)
   - Tree view of CompiledProgramIR structure
   - Collapsible sections: Nodes, Buses, Fields, Signals
   - Click-to-expand details

2. **ScheduleTab** (`src/editor/debug-ui/ScheduleTab.tsx`)
   - Visual representation of schedule steps
   - Step dependency graph (optional: SVG lines between steps)
   - Step type indicators (colored pills)
   - Click-to-expand step details

3. **REPL Commands** (in `DebugStore.ts`)
   - `ir` - Show IR summary
   - `ir nodes` - List all nodes
   - `ir buses` - List all buses
   - `ir node <id>` - Inspect specific node
   - `schedule` - Show schedule overview
   - `schedule step <index>` - Inspect specific step

### Integration Points

- Add "IR" and "Schedule" tabs to DebugDrawer
- Extend DebugUIStore with new tab types
- Access compile result via `window.__compilerService` (already exposed)

## File Changes

### New Files
- `src/editor/debug-ui/IRTab.tsx` - IR visualization component
- `src/editor/debug-ui/IRTab.css` - Styles
- `src/editor/debug-ui/ScheduleTab.tsx` - Schedule visualization component
- `src/editor/debug-ui/ScheduleTab.css` - Styles

### Modified Files
- `src/editor/debug-ui/DebugDrawer.tsx` - Add new tabs
- `src/editor/debug-ui/index.ts` - Export new components
- `src/editor/stores/DebugUIStore.ts` - Add new tab types
- `src/editor/stores/DebugStore.ts` - Add REPL commands

## Visual Design

### IRTab Layout
```
┌─ IR ────────────────────────────────────────────────┐
│ irVersion: 1 | patchId: abc123 | seed: 42           │
├─────────────────────────────────────────────────────┤
│ ▼ Nodes (5)                                         │
│   ├─ node-0: CycleTimeRoot                          │
│   ├─ node-1: SineOsc                                │
│   └─ ...                                            │
│ ▼ Buses (2)                                         │
│   ├─ bus:phase                                      │
│   └─ bus:time                                       │
│ ▼ Time Model                                        │
│   kind: cyclic, periodMs: 3000                      │
└─────────────────────────────────────────────────────┘
```

### ScheduleTab Layout
```
┌─ Schedule ──────────────────────────────────────────┐
│ Steps: 8 | Time Model: cyclic (3000ms)              │
├─────────────────────────────────────────────────────┤
│ ┌─────────────┐                                     │
│ │ 0: timeDerive│ ──▶ ┌───────────────┐              │
│ └─────────────┘      │ 1: signalEval │──▶ ...      │
│                      └───────────────┘              │
│                                                     │
│ ──── Step List ────                                 │
│ [TIME] 0: timeDerive                                │
│ [SIG]  1: signalEval → slot:2                       │
│ [BUS]  2: busEval → bus:phase                       │
│ [MATL] 3: materialize → buffer:0                    │
│ [RNDR] 4: renderAssemble                            │
└─────────────────────────────────────────────────────┘
```

## Implementation Order

1. Add DebugUIStore tab types
2. Implement IRTab with basic tree view
3. Implement ScheduleTab with step list
4. Add REPL commands to DebugStore
5. Wire up to DebugDrawer
6. Add styling

## Risks & Mitigations

- **Large IR structures**: Use virtualization or collapse by default
- **Missing programIR**: Show "No IR available" placeholder when not compiled
- **Type safety**: Use existing IR types from `src/editor/compiler/ir/`
