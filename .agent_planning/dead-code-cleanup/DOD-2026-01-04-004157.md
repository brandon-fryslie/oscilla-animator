# Definition of Done: Dead Code Cleanup Sprint

**Generated**: 2026-01-04-004157
**Plan**: PLAN-2026-01-04-004157.md
**Topic**: dead-code-cleanup

---

## Acceptance Criteria

### P0-1: Delete Backup Files

- [ ] All 4 backup files deleted from repository
  - [ ] `src/editor/modulation-table/ModulationTableStore.ts.orig` deleted
  - [ ] `src/editor/runtime/executor/RuntimeState.ts.orig` deleted
  - [ ] `src/editor/stores/PatchStore.ts.orig` deleted
  - [ ] `src/editor/compiler/compileBusAware.ts.backup` deleted
- [ ] `just check` passes (typecheck + lint + test)
- [ ] `just build` completes successfully
- [ ] Git status shows 4 deletions, no build errors

### P0-2: Prevent Future Backup File Commits

- [ ] `.gitignore` updated with `*.orig`, `*.backup`, `*.bak` patterns
- [ ] Test verification: create `test.ts.orig` and verify `git status` does NOT show it as untracked
- [ ] Test file deleted after verification
- [ ] Changes committed with message documenting the prevention of backup file commits

### P1-1: Delete Compositor Module (Dead Code)

- [ ] Entire `src/editor/compositor/` directory deleted (9 files)
- [ ] `just typecheck` passes with zero errors
- [ ] `just test` passes all 2162+ tests (no new failures)
- [ ] `just build` completes successfully
- [ ] Grep verification: `grep -r "from.*compositor" src/` returns no results
- [ ] Commit message documents what was removed and why (dead code, zero external imports)

### P1-2: Complete Adapter Module Migration and Cleanup

- [ ] ModulationTableStore.ts adapter import analyzed - usage determined (used vs. unused)
- [ ] **If used**: equivalent functionality migrated to TRANSFORM_REGISTRY
- [ ] **If used**: migration verified with tests (ModulationTableStore functionality intact)
- [ ] **If used**: manual verification in dev server (`just dev`) confirms modulation table works
- [ ] ModulationTableStore.ts import removed (no longer references `adapters/`)
- [ ] Grep verification: `grep -r "from.*adapters" src/` returns zero results
- [ ] Entire `src/editor/adapters/` directory deleted (2 files, 441 lines)
- [ ] `just check` passes (typecheck + lint + test)
- [ ] `just build` completes successfully

---

## Sprint Scope

**This sprint delivers**:
1. ✅ Clean repository (4 backup files removed)
2. ✅ Protected repository (.gitignore prevents future backup commits)
3. ✅ Dead compositor module removed (verified zero external imports)
4. ✅ Adapter migration completed OR deferred with clear documentation

**Deferred to future sprints**:
- P2-1: Remove unused npm dependency `@dnd-kit/sortable` (low impact, can batch later)
- P2-2: DefaultSource block duplication refactor (optimization, needs careful design)
- compileBusAware.ts removal (has active imports, needs migration first)
- Full "103 unimported files" cleanup (audit methodology questionable, needs re-verification)

---

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Lines of code removed | 4,000+ | `git diff --stat` after all commits |
| Backup files in repo | 0 | `git ls-files \| grep -E '\.(orig\|backup\|bak)$'` returns empty |
| Dead modules removed | 1-2 | Compositor deleted (confirmed), adapters deleted (if migration succeeds) |
| Build health | All passing | `just check && just build` exits 0 |
| Test suite health | 2162+ passing | `just test` shows all tests pass |

---

## Rollback Criteria

**Abort P1-2 (Adapter Migration) if**:
- TRANSFORM_REGISTRY lacks feature parity with AdapterRegistry
- Migration would require more than 4 hours of work
- ModulationTableStore functionality breaks in manual testing
- No clear migration path identified

**In case of abort**: Document findings, keep adapters module as "deprecated but functional", file issue for future completion.

---

## Post-Sprint Checklist

- [ ] Update DEAD-CODE-AUDIT.md to mark completed items
- [ ] File GitHub issues for deferred work:
  - [ ] P2-1: Remove @dnd-kit/sortable dependency
  - [ ] P2-2: DefaultSource duplication refactor
  - [ ] Fix ModulationTableStore tests (if still broken)
- [ ] Re-run dead code analysis with ts-prune or depcheck
- [ ] Plan next cleanup sprint (if needed)
- [ ] Document lessons learned from this cleanup sprint
