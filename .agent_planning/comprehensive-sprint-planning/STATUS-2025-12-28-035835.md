# Comprehensive Project Status
**Generated**: 2025-12-28-035835
**Evaluator**: status-planner
**Scope**: All incomplete work across ROADMAP phases
**Source**: ROADMAP.md + topic-specific STATUS files

---

## Executive Summary

**Project Status**: IR Compiler Migration 75% complete, UI/UX work 30% complete
**Total Test Health**: 1873 passing, 79 failing (96% pass rate)
**Critical Blockers**: 3 (test failures, runtime wiring, undo-redo Phase 3)
**Readiness for Next Phase**: PARTIAL - foundation solid, execution layer incomplete

The project has successfully completed Phases 1-5 (IR types, evaluators, field materialization) but has **significant incomplete work** across three major dimensions:

1. **Runtime Execution** (Phase 6-7): Scheduled runtime 75% done, Debug HUD backend 0% wired
2. **Undo-Redo** (Phase 9): Phase 2 complete, Phase 3 high-priority operations pending
3. **UI/UX Architecture** (Phase 10): 35-40% complete, major gaps in validation, kernel integration, test stability

---

## Phase 6: Scheduled Runtime (75% Complete)

### ✅ COMPLETE
- ValueStore + StateBuffer (47 tests)
- RuntimeState integration (17 tests)
- FrameCache system (41 tests)
- Step executors: executeTimeDerive, executeBusEval, executeMaterialize (30 tests)
- SigEvaluator integration (122+ tests)
- FieldMaterializer integration (63+ tests)

### ⚠️ PARTIAL
**executeNodeEval** (Status: UNKNOWN NECESSITY)
- IR type defined but compiler may not emit NodeEval steps
- Stub exists but not implemented
- **Action Required**: Verify compiler output BEFORE implementing
- If unused: Mark deprecated, skip implementation
- If used: 100 lines + 25-30 tests required

**renderer-ir-pipeline** (Status: 60% infrastructure, 0% wired)
- Infrastructure: renderSink API exists, buffer materialization works
- **Critical Gaps**:
  - Block lowering does NOT emit StepMaterializeColor/Path
  - executeRenderAssemble is no-op stub
  - PreviewPanel uses legacy render(), not IR renderFrame()
  - IRRuntimeAdapter in bridge mode, not pure IR
- **Remaining Work**:
  1. Emit materialize steps for color/path fields
  2. Implement executeRenderAssemble finalization
  3. Wire PreviewPanel to IR renderFrame()
  4. Enable pure IR mode (no legacy bridge)

### ❌ NOT STARTED
**hot-swap-semantics** (PROPOSED)
- State preservation via layout-hash matching
- Cache discard policy
- Time continuity across recompile
- **Critical for UX** per spec - no-jank live editing
- **Estimated**: 300-400 lines implementation + 250-350 lines tests (50-60 tests)
- **Files**: StateSwap.ts (new), RuntimeState.hotSwap(), ScheduleExecutor.swapProgram()

**determinism-enforcement** (PROPOSED)
- Stable topo sort with explicit tie-breaks
- Publisher ordering from IR
- No Map/Set iteration
- **Test requirement**: Same inputs → bitwise-identical outputs

**legacy-runtime-removal** (PROPOSED)
- Remove closure-based runtime after validation
- Clean up dual-emit code paths
- **Depends on**: All Phase 6 complete

---

## Phase 7: Debug Infrastructure (30% Complete)

### ✅ COMPLETE (Existing Infrastructure)
- type-key-encoding (TypeKeyId encoding)
- span-ring-buffer (SpanRing)
- value-record-encoding (ValueRecord)
- trace-controller (mode switching)

### ⚠️ IN PROGRESS (Sprint 1 Focus)

**debug-index-compile** (IN PROGRESS)
- Emit DebugIndex during compilation
- Track blockId when allocating signal/field expressions
- Populate sigExprSource, fieldExprSource, slotSource maps
- **Status**: Types exist, population logic incomplete

**execute-debug-probe** (IN PROGRESS)
- Read TraceController.mode
- Sample values from slots
- Record to ValueRing with timestamp
- Throttle UI events to 10Hz
- **Status**: Type defined, execution logic incomplete

**debug-hud-backend** (CRITICAL - 0% WIRED)
- **UI**: 55% complete (components exist)
- **Backend**: 0% complete (BLOCKER)
- **Critical Gap**: Player.emitHealthSnapshot() never populates `busValues` field
- **Missing Hover Handlers**:
  - BusChannel has no onMouseEnter/onMouseLeave
  - No probe mode cursor tracking
  - No block hover integration
- **Remaining Work**:
  1. Determine bus value source (BusStore.currentValue vs ScheduleExecutor slots)
  2. Populate busValues in Player.emitHealthSnapshot()
  3. Add BusChannel/BusBoard hover handlers
  4. Wire document mousemove for cursor position
  5. Create debug-ui unit tests (0% coverage)

**schedule-probe-insertion** (PROPOSED)
- Insert StepDebugProbe at key boundaries
- Basic/full probe modes
- **Depends on**: execute-debug-probe complete

### ❌ FUTURE (Phase 7.2+)
- causal-edge-system
- instrumentation-hooks
- debug-drawer (UI exists, backend incomplete)
- probe-mode (UI partial)
- value-summary-display
- issue-detection

---

## Phase 9: Undo-Redo (60% Complete - Phase 2 Done, Phase 3 High Priority)

### ✅ COMPLETE (Phase 2 - 87 Tests Passing)
- Transaction infrastructure: runTx(), tx.add(), tx.remove(), tx.replace()
- **PatchStore**: addBlock, removeBlock, updateBlock, updateBlockParams, connect, disconnect
- **BusStore**: createBus, deleteBus, updateBus, addPublisher, updatePublisher, removePublisher, addListener, updateListener, removeListener
- Deep clone fix for tx.replace() undo bug

### ⚠️ HIGH PRIORITY (Phase 3 - 8 Methods)

**replaceBlock()** (BROKEN - CRITICAL)
- **Current State**: NOT migrated to runTx()
- **Bug**: Partial undo leaves orphaned blocks (removeBlock now uses runTx, but replaceBlock doesn't)
- **Complexity**: HIGH (double transaction problem, event ordering)
- **Migration Strategy**: Single runTx with add new block + copy connections + removeBlockCascade
- **Tests**: 5+ integration tests needed

**Lens Operations** (7 methods - MEDIUM)
- PatchStore: updateConnection, addLensToConnection, removeLensFromConnection, updateConnectionLens
- BusStore: addLensToStack, removeLensFromStack, clearLensStack
- **Complexity**: MEDIUM (straightforward runTx pattern)
- **Tests**: 10+ tests needed

**addBlockAtIndex()** (MEDIUM)
- Direct mutations (blocks.push, lane modification)
- Calls processAutoBusConnections (nested transactions)
- **Complexity**: MEDIUM
- **Tests**: 3+ tests needed

### ❌ DEFERRED (Phase 4+)
- expandMacro (needs clearPatch atomicity decision)
- Block positions (needs gesture buffer)
- IndexedDB persistence
- History tree visualization
- Advanced UI (map view, variations)

---

## Phase 10: UI/UX & Architecture (35-40% Complete)

### ✅ COMPLETE (2/9 UI Prep Specs)
- Port Identity (PortRef canonical)
- Time Authority (Player obeys TimeRoot)

### ⚠️ PARTIAL

**ui-prep-refactor** (35-40% complete)
- **Semantic Kernel**: 60% infrastructure, 0% integration
  - PatchKernel types defined
  - Op types complete (26 ops)
  - TxBuilder stub only
  - NOT integrated with stores
- **SemanticGraph**: 60% complete (validator exists, not integrated with UI)
- **Layout Separation**: 0% (lanes still in Patch)
- **DefaultSources**: 60% (store exists, implicit phaseA binding missing)
- **Remaining Specs**: 7 incomplete (DivergentTypes, PatchSemantics, StatePreservation, etc.)
- **Critical Gaps**:
  1. Kernel applyOp() implementation
  2. TimeRoot auto-publish to phaseA/pulse
  3. Wire stores to kernel transactions
  4. Validator integration with UI mutations

**3d-config-ui** (40% ready)
- **Runtime**: COMPLETE (CameraStore, MeshStore, step executors)
- **UI/Block Layer**: 0%
  - NO Vec3Editor control
  - NO Camera block definition
  - NO Mesh block definition
  - NO RenderInstances3D block
  - NO Camera/Mesh compilers
- **Remaining Work**:
  1. Create Vec3Editor UI control (uiHint.kind: 'vec3')
  2. Create Camera block definition + compiler
  3. Create RenderInstances3D block
  4. (Optional) Create Mesh block for advanced use

**primitives-enforcement** (25% complete)
- **NO capability field** on BlockDefinition
- **NO KERNEL_PRIMITIVES** allowlist file
- **NO registration validation** (validateBlockDefinition)
- **NO CI enforcement** (pre-commit hook, GitHub Actions)
- **Remaining Work**:
  1. Add capability field to BlockDefinition
  2. Create kernel-primitives.ts allowlist
  3. Implement validateBlockDefinition()
  4. Add CI check script + workflow

### ❌ NOT STARTED (0%)

**wire-lenses** (0% - wires have no lens support)
- Connection interface lacks lensStack/adapterChain fields
- Compiler wire resolution doesn't apply lenses
- UI has no lens editor for wires
- **Remaining Work**:
  1. Extend Connection interface with lensStack/adapterChain
  2. Update PatchStore with updateConnection methods
  3. Apply lenses in compiler wire resolution
  4. Create shared LensChainEditor component
  5. Add lens section to WireConnectionView

**connection-inspector** (0% - NOT STARTED)
- NO ConnectionInspector component
- NO selectedConnection UI state
- NO entry points (Port inspector, ModulationTable, BusBoard)
- NO embedded lens editor variant
- **Remaining Work**:
  1. Create ConnectionInspector component
  2. Add selectedConnection to UIStore
  3. Add entry points (Port inspector click, ModulationTable cell click)
  4. Create/refactor LensChainEditor for inline use

**test-fixes** (79 failing tests, 826 lint errors - CRITICAL)
- **Test Failures**: 15 test files failing
  - 21 TimeRoot output expectation mismatches
  - 9 missing exports (extractTimeRootPorts, validateTimeRootDependencies)
  - 8 DiagnosticHub logic issues
  - 3 compiler validation not implemented
- **Lint Errors**: 826 errors, 100 warnings
- **BLOCKER**: Spec violation questions unanswered (TimeRoot outputs - is spec or impl correct?)
- **Remaining Work**:
  1. Resolve TimeRoot output spec ambiguity
  2. Export missing functions
  3. Fix DiagnosticHub event handling + muting
  4. Implement compiler validation rules
  5. Lint cleanup pass

---

## Quantitative Metrics

```
PHASE COMPLETION:
Phase 1 (Contracts & Types):     100%  ✅
Phase 2 (IR Data Structures):    100%  ✅
Phase 3 (Bridge Compiler):       100%  ✅
Phase 4 (SignalExpr Runtime):    100%  ✅
Phase 5 (FieldExpr + Material):  100%  ✅
Phase 6 (Scheduled Runtime):      75%  ⚠️  (renderer-ir, hot-swap, determinism pending)
Phase 7 (Debug Infrastructure):   30%  ⚠️  (debug-hud backend CRITICAL BLOCKER)
Phase 9 (Undo-Redo):              60%  ⚠️  (Phase 3 high priority)
Phase 10 (UI/UX):                 35%  ⚠️  (kernel integration, test stability CRITICAL)

TEST HEALTH:
Passing:        1873 tests (96%)
Failing:          79 tests (4%)
Skipped:           4 tests
Total:          1956 tests

LINT HEALTH:
Errors:         826
Warnings:       100

TECHNICAL DEBT:
High Priority:     5 items (test failures, debug-hud backend, replaceBlock, renderer-ir, hot-swap)
Medium Priority:  11 items (lens ops, 3d-config-ui, wire-lenses, primitives-enforcement)
Low Priority:     15 items (connection-inspector, legacy-runtime-removal, lint cleanup)
```

---

## Critical Blockers (Prevent Further Progress)

### 1. Test Failures (79 tests - BLOCKER)
**Impact**: Cannot verify correctness, breaks CI/CD
**Root Cause**: TimeRoot spec ambiguity + missing exports + DiagnosticHub bugs
**Action Required**: User must clarify TimeRoot output specification
**Estimated Fix**: 2-3 hours after clarification

### 2. Debug HUD Backend (0% wired - BLOCKER for Phase 7)
**Impact**: Debug UI shows "No value" for all buses
**Root Cause**: Player.emitHealthSnapshot() never populates busValues
**Action Required**: Determine bus value source, wire backend
**Estimated Fix**: 4-6 hours

### 3. replaceBlock() Undo Bug (BROKEN - BLOCKER for Undo-Redo)
**Impact**: Partial undo leaves orphaned blocks in patch
**Root Cause**: Mixed transaction modes (nested runTx calls)
**Action Required**: Migrate to single runTx transaction
**Estimated Fix**: 6-8 hours

---

## Dependencies Between Incomplete Work

```
Phase 6:
  renderer-ir-pipeline ──> hot-swap-semantics ──> legacy-runtime-removal
                  │
                  └──> Phase 7 (debug infrastructure)

Phase 7:
  debug-index-compile ──> execute-debug-probe ──> schedule-probe-insertion
                                  │
                                  └──> debug-hud-backend (BLOCKER)

Phase 9:
  replaceBlock (BLOCKER) ──> lens operations ──> addBlockAtIndex

Phase 10:
  test-fixes (BLOCKER) ──> ui-prep-refactor ──> wire-lenses ──> connection-inspector
                                  │
                                  └──> 3d-config-ui
                                  │
                                  └──> primitives-enforcement
```

---

## Risk Assessment

| Risk | Severity | Likelihood | Mitigation |
|------|----------|------------|------------|
| Test failures block release | HIGH | CERTAIN | Fix TimeRoot tests first (2-3 hours) |
| Debug HUD unusable without backend | HIGH | CERTAIN | Wire busValues in Player (4-6 hours) |
| Undo-redo broken for critical ops | MEDIUM | CERTAIN | Migrate replaceBlock to runTx (6-8 hours) |
| Renderer-IR incomplete blocks 3D | MEDIUM | HIGH | Complete materialize step emission |
| Hot-swap missing breaks UX | MEDIUM | HIGH | Implement StateSwap module (8-10 hours) |
| UI prep refactor stalled | LOW | MEDIUM | Focus on kernel integration |
| Primitives enforcement absent | LOW | LOW | Add validation incrementally |

---

## Known Issues

1. **TimeRoot Output Spec Ambiguity**: Unclear if FiniteTimeRoot should have phase output, if InfiniteTimeRoot should auto-publish phase/pulse
2. **Bus Value Source Uncertainty**: Unknown if bus values live in BusStore.currentValue or ScheduleExecutor slots
3. **NodeEval Necessity Unknown**: Compiler may not emit NodeEval steps, verification required before implementation
4. **Legacy Runtime Dual-Mode**: Still running both closure and IR evaluators, performance impact unknown

---

## Files Requiring Changes (Summary)

### Phase 6 (Renderer + Hot-swap)
- `src/editor/compiler/blocks/domain/RenderInstances2D.ts` - emit materialize steps
- `src/editor/runtime/executor/steps/executeRenderAssemble.ts` - implement finalization
- `src/editor/components/PreviewPanel.tsx` - use IR renderFrame()
- `src/editor/runtime/executor/StateSwap.ts` - NEW FILE (hot-swap logic)
- `src/editor/runtime/executor/RuntimeState.ts` - add hotSwap() method
- `src/editor/runtime/executor/ScheduleExecutor.ts` - add swapProgram() method

### Phase 7 (Debug HUD Backend)
- `src/editor/runtime/player.ts` - populate busValues in emitHealthSnapshot()
- `src/editor/BusChannel.tsx` - add hover handlers
- `src/editor/stores/BusStore.ts` - add currentValue field (if chosen)
- `src/editor/debug-ui/__tests__/` - NEW DIRECTORY (unit tests)

### Phase 9 (Undo-Redo Phase 3)
- `src/editor/stores/PatchStore.ts` - replaceBlock(), updateConnection(), addLensToConnection(), removeLensFromConnection(), updateConnectionLens(), addBlockAtIndex()
- `src/editor/stores/BusStore.ts` - addLensToStack(), removeLensFromStack(), clearLensStack()
- `src/editor/transactions/__tests__/` - 20+ new integration tests

### Phase 10 (UI/UX)
- `src/editor/blocks/types.ts` - add capability field to BlockDefinition
- `src/editor/blocks/kernel-primitives.ts` - NEW FILE (allowlist)
- `src/editor/blocks/registry-validation.ts` - NEW FILE (validateBlockDefinition)
- `src/editor/types.ts` - extend Connection with lensStack/adapterChain
- `src/editor/components/ConnectionInspector.tsx` - NEW FILE
- `src/editor/components/Vec3Editor.tsx` - NEW FILE
- `src/editor/blocks/camera.ts` - NEW FILE
- `src/editor/compiler/blocks/domain/Camera.ts` - NEW FILE
- `src/editor/kernel/PatchKernel.ts` - implement applyOp()
- 79 failing test files - fix expectations + exports + logic

---

## Recommendations

### Immediate Actions (Next Sprint)
1. **Fix test failures** (BLOCKER) - 2-3 hours after TimeRoot spec clarification
2. **Wire Debug HUD backend** (BLOCKER) - 4-6 hours
3. **Migrate replaceBlock() to runTx** (BLOCKER) - 6-8 hours

### High-Priority Work (Sprint 2)
4. Complete renderer-ir-pipeline (materialize steps + executeRenderAssemble) - 8-10 hours
5. Implement hot-swap-semantics (state preservation) - 8-10 hours
6. Migrate lens operations to runTx (7 methods) - 4-6 hours

### Medium-Priority Work (Sprint 3+)
7. Complete ui-prep-refactor (kernel applyOp, TimeRoot auto-publish) - 12-16 hours
8. Add 3d-config-ui (Vec3Editor + Camera block) - 8-10 hours
9. Implement wire-lenses (extend Connection, compiler, UI) - 10-12 hours

### Low-Priority Work (Future Sprints)
10. Create connection-inspector - 12-16 hours
11. Add primitives-enforcement (capability field, validation) - 6-8 hours
12. Lint cleanup pass - 4-6 hours

---

## Conclusion

The project has a **solid foundation** (Phases 1-5 complete) but **critical execution layer gaps** in Phases 6-7 and **architectural drift** in Phase 10. The three BLOCKERS (test failures, debug-hud backend, replaceBlock undo bug) must be resolved before further progress.

**Next Action**: Resolve TimeRoot output specification ambiguity, then execute blocker fixes in parallel.
