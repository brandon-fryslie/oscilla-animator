# STATUS: Adapter Library Implementation

**Date:** 2025-12-20
**Topic:** adapter-library
**Phase:** Planning

## Current State

### What Exists (Solid Foundation)
1. **Core Lens Engine** (`src/editor/lenses.ts`) - 7 lens types working:
   - Ease (8 easing functions), Slew, Quantize, Scale, Warp, Broadcast, PerElementOffset

2. **Lens Presets** (`src/editor/lens-presets.ts`) - 11 presets:
   - Breathing, Snap, Smooth, Bounce, Elastic, Slow Start/End, Fine/Coarse Steps, etc.

3. **Type System** (`src/editor/types.ts`):
   - `LensDefinition` interface with type + params
   - `LensType` union type
   - `Listener` interface has `lens?: LensDefinition`

4. **Bus Store Integration** - MobX observability for lens changes

5. **Compiler Integration** (`compileBusAware.ts:586`) - Applies single lens to bus artifact

6. **UI Components** - `LensSelector.tsx`, `BusInspector.tsx` with preset selection

7. **Tests** - 28 tests passing for all lens types

### What's Missing (per 04-Adapters.md spec)

| Gap | Priority | Description |
|-----|----------|-------------|
| **Lens Stacks** | HIGH | Only single lens supported, spec requires chained lenses |
| **Clamp Lens** | HIGH | `clamp(min, max)` - critical for safe value bounding |
| **Reduce Adapters** | MEDIUM | `fieldSum`, `fieldMean`, `fieldMax` - Field→Signal |
| **Cast Adapters** | MEDIUM | `phaseToNumber`, `numberToPhase`, etc. |
| **Offset Lens** | LOW | Separate from scale (currently combined) |
| **Additional Shaping** | LOW | deadzone, mapRange, softclip, wavefold |

## Architecture Assessment

### Correctly Positioned
- Lens as perception operator (on listener, not bus) ✓
- Applied after bus retrieval, before block input ✓
- Stateless by default, stateful marked ✓
- Deterministic evaluation ✓

### Needs Extension (Not Architectural Change)
- `lens?: LensDefinition` → `lensStack?: LensDefinition[]`
- Compiler loop through stack
- UI for stack management

## Blockers
None - foundation is solid, extension path is clear.

## Dependencies
- Design spec: `design-docs/3-Synthesized/04-Adapters.md`
- Existing implementation: `src/editor/lenses.ts`
