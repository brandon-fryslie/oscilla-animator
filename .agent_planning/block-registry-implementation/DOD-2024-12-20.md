# Definition of Done: Block Registry Implementation (Vertical Slices)
**Generated:** 2024-12-20

---

## Guiding Principles

1. **Every primitive MUST be used in 2+ composites** before "done"
2. **Every block MUST be bus-compatible** (can publish to or subscribe from buses)
3. **Validate via composites** - Primitives are done when composites work

---

## Slice-Based Acceptance Criteria

### Slice 1: Breathing Energy System ✅ Validates: Oscillator, Shaper, AddSignal, MulSignal
- [ ] **Oscillator** block produces sine, cosine, triangle, saw waveforms
- [ ] **Shaper** block applies tanh, softclip, sigmoid, smoothstep, pow
- [ ] **AddSignal** block adds two signals
- [ ] **MulSignal** block multiplies two signals
- [ ] **BreathEnergy composite** publishes breathing curve to `energy` bus
- [ ] Energy bus meter shows smooth oscillation when composite is added

### Slice 2: Rhythmic Accent System ✅ Validates: PulseDivider, EnvelopeAD
- [ ] **PulseDivider** block generates tick events at subdivisions
- [ ] **EnvelopeAD** block triggers on pulse, decays over time
- [ ] **PulseAccentEnergy composite** adds rhythmic accents to `energy` bus
- [ ] Energy bus meter shows both breathing + accents

### Slice 3: Color Palette System ✅ Validates: ColorLFO, MinSignal, MaxSignal, ClampSignal
- [ ] **ColorLFO** block produces smooth hue cycling from phase
- [ ] **MinSignal** block returns minimum of two signals
- [ ] **MaxSignal** block returns maximum of two signals
- [ ] **ClampSignal** block clamps signal to range
- [ ] **SlowPaletteDrift composite** publishes to `palette` bus
- [ ] Palette bus swatch shows slow color drift

### Slice 4: Per-Element Identity System ✅ Validates: GridDomain, StableIdHash
- [ ] **GridDomain** block outputs domain + Field<vec2> positions
- [ ] **StableIdHash** block produces deterministic per-element [0,1) from stable IDs
- [ ] Same seed = same per-element values across runs
- [ ] Used in BreathingDotsRenderer composite

### Slice 5: Field-Signal Combination System ✅ Validates: FieldFromSignalBroadcast, FieldZipSignal
- [ ] **FieldFromSignalBroadcast** block broadcasts Signal value to all Field elements
- [ ] **FieldZipSignal** block combines Field + Signal with add/sub/mul/min/max
- [ ] Used in Golden Patch for phase spread calculation

### Slice 6: Position Animation System ✅ Validates: JitterFieldVec2, FieldAddVec2
- [ ] **JitterFieldVec2** block produces animated per-element drift
- [ ] **FieldAddVec2** block adds vec2 fields element-wise
- [ ] Dots show subtle position drift when used in BreathingDotsRenderer

### Slice 7: Visual Styling System ✅ Validates: FieldColorize, FieldOpacity
- [ ] **FieldColorize** block applies color variations per element
- [ ] **FieldOpacity** block sets per-element opacity
- [ ] Used in BreathingDotsRenderer for visual variety

### Slice 8: Viewport Information ✅ Validates: ViewportInfo
- [ ] **ViewportInfo** block outputs viewport size and center as Scalars
- [ ] GridDomain can use ViewportInfo center for positioning

### Slice 9: Full Rendering Composite ✅ Final Validation
- [ ] **BreathingDotsRenderer composite** works end-to-end
- [ ] Golden Patch can be fully constructed with new blocks
- [ ] 400 dots (20x20) animate smoothly with breathing + drift + color

---

## Bus Compatibility (Required for All Blocks)

| Block | Subscribe From | Publish To |
|-------|---------------|------------|
| Oscillator | phaseA | energy |
| Shaper | any Signal | energy |
| PulseDivider | phaseA | pulse |
| EnvelopeAD | pulse | energy |
| ColorLFO | phaseA, phaseB | palette |
| AddSignal | any Signal x2 | any |
| MulSignal | any Signal x2 | any |

---

## Quality Gates

- [ ] `just typecheck` passes
- [ ] `just lint` passes
- [ ] `just test` passes
- [ ] All blocks appear in block palette
- [ ] All blocks can be connected without type errors
- [ ] No runtime errors when using blocks

---

## Summary

**18 Primitives** organized into **9 Vertical Slices**, each validated by composite usage:

| Slice | Primitives | Composite Validation |
|-------|-----------|---------------------|
| 1 | Oscillator, Shaper, AddSignal, MulSignal | BreathEnergy |
| 2 | PulseDivider, EnvelopeAD | PulseAccentEnergy |
| 3 | ColorLFO, MinSignal, MaxSignal, ClampSignal | SlowPaletteDrift |
| 4 | GridDomain, StableIdHash | BreathingDotsRenderer |
| 5 | FieldFromSignalBroadcast, FieldZipSignal | Golden Patch |
| 6 | JitterFieldVec2, FieldAddVec2 | BreathingDotsRenderer |
| 7 | FieldColorize, FieldOpacity | BreathingDotsRenderer |
| 8 | ViewportInfo | GridDomain centering |
| 9 | - | BreathingDotsRenderer (full) |
