# Definition of Done: Sprint 0 - Unblock Test Infrastructure

**Generated:** 2025-12-28-154800
**Plan:** PLAN-2025-12-28-154800.md
**Topic:** compiler-audit-redflag

---

## Sprint Scope

**This sprint delivers:**
1. Fixed block registry capability propagation (27 test files can load)
2. Test suite baseline documentation
3. Sprint 1 entry criteria definition

**Deferred to future sprints:**
- All 43 IR compiler red flags (Critical/High/Medium)
- Block lowering, bus evaluation, type conversions, etc.

---

## Acceptance Criteria

### Deliverable 1: Block Registry Capability Propagation Fixed

- [ ] All 21 blocks with capability mismatches have BlockDefinition.capability field correctly populated
- [ ] Registry validation passes at module load (no capability mismatch errors)
- [ ] All 27 previously failing test files can be imported without registry errors
- [ ] `registerBlockType()` function correctly propagates capability parameter to BlockDefinition object
- [ ] Zero test files fail at module load due to registry validation

**Verification:**
```bash
just test 2>&1 | grep -i "registry validation failed"
# Expected output: (none - zero matches)

just test 2>&1 | grep -i "capability mismatch"
# Expected output: (none - zero matches)
```

---

### Deliverable 2: Test Suite Baseline Documented

- [ ] Full test suite runs with `just test` without module load failures
- [ ] Document total test count (files and individual tests)
- [ ] Document pass/fail breakdown with categories (e.g., "IR not implemented", "legacy bugs", "flaky")
- [ ] Create baseline report saved to `.agent_planning/compiler-audit-redflag/TEST-BASELINE-2025-12-28.md`
- [ ] Identify any NEW failures introduced by registry fix (should be zero)

**Verification:**
```bash
cat .agent_planning/compiler-audit-redflag/TEST-BASELINE-2025-12-28.md
# Expected: Contains summary, pass/fail counts, categorized failures

just test
# Expected: All test files import successfully, known failures documented
```

---

### Deliverable 3: Sprint 1 Entry Criteria Defined

- [ ] Document created at `.agent_planning/compiler-audit-redflag/SPRINT-1-ENTRY.md`
- [ ] Entry criteria include minimum test pass rate (e.g., "90% of compiler tests pass")
- [ ] Entry criteria include specific test categories that must work (e.g., "all store tests pass")
- [ ] Document identifies any remaining test infrastructure risks
- [ ] Document approved by running test suite and verifying all criteria met

**Verification:**
```bash
cat .agent_planning/compiler-audit-redflag/SPRINT-1-ENTRY.md
# Expected: Clear checklist of conditions, verification commands

# All entry criteria must be verifiable:
just test  # Should satisfy criteria in SPRINT-1-ENTRY.md
```

---

## Sprint Complete When

**All of the following are true:**

1. **Zero module load failures**
   - Command: `just test 2>&1 | grep "Error: Registry validation failed"`
   - Expected: No matches

2. **All acceptance criteria checked**
   - All 15 criteria above have checkmarks
   - Each verified through commands or file inspection

3. **Documentation exists and is current**
   - TEST-BASELINE-2025-12-28.md present and accurate
   - SPRINT-1-ENTRY.md present with clear criteria

4. **Ready signal given**
   - Test infrastructure is unblocked
   - IR compiler work can begin (Sprint 1)

---

## Out of Scope (Future Work)

**Not delivered in Sprint 0:**

- IR compilation made mandatory (Sprint 1)
- TimeModel threading (Sprint 1)
- Block lowering implementation (Sprint 2)
- Bus evaluation steps (Sprint 3)
- Type conversion paths (Sprint 4)
- All 43 documented red flags (Sprints 1-5+)

**Rationale:** Must fix test infrastructure before addressing compiler issues. Sprint 0 is purely foundational.

---

## Risk Mitigations Applied

- **Unknown test failures:** Documented in baseline, deferred fixes to Sprint 1+
- **Registry side effects:** Any exposed issues documented and triaged
- **Scope creep:** Strict focus on infrastructure only, no IR fixes

---

## Handoff to Sprint 1

**Prerequisites verified:**
- [ ] Block registry validation works
- [ ] Test suite runs end-to-end
- [ ] Baseline state documented
- [ ] Entry criteria defined and met

**Next sprint can begin when:**
- All DOD criteria met
- SPRINT-1-ENTRY.md criteria satisfied
- No blocking test infrastructure issues remain
