# Definition of Done: Legacy Code Removal Sprint

**Generated:** 2025-12-27-030413
**Plan:** PLAN-2025-12-27-030413.md
**Sprint Focus:** Low-risk legacy cleanup (2 deliverables)

---

## Sprint Scope

This sprint delivers:
1. Legacy DebugStore API removal (7 deprecated methods)
2. Legacy Events removal (8 granular event types)

Deferred:
- paramSchema removal (needs Inspector verification)
- Feature Flags (waiting for IR compiler stability)
- Legacy type/lens aliases (too low value or intentionally kept)

---

## Acceptance Criteria

### Deliverable 1: Legacy DebugStore API Removal

- [ ] All 4 call sites in `debugSampler.ts` updated to use `isBlockProbed()` instead of `isBlockDebugging()`
- [ ] Verified `DebugDisplay.ts` doesn't use deprecated methods (or updated if it does)
- [ ] Removed all 7 deprecated methods from `DebugStore.ts` (lines 809-900):
  - [ ] `isBlockDebugging()` removed
  - [ ] `debuggingBlockIds` getter removed
  - [ ] `toggleBlockDebug()` removed
  - [ ] `setEntry()` removed
  - [ ] `replLines` getter removed
  - [ ] `clearRepl()` removed
  - [ ] `addReplLine()` removed
- [ ] TypeScript compiles with no errors (`just typecheck`)
- [ ] Existing DebugStore tests still pass
- [ ] No runtime errors when toggling debug/probe mode in the UI
- [ ] Behavior is identical before and after changes

### Deliverable 2: Legacy Events Removal

- [ ] Audited test files to identify which tests validate important behavior vs just event emission
- [ ] Migrated important behavior tests to use `GraphCommitted` event (or kept if validating valid store behavior)
- [ ] Removed event type definitions from `events/types.ts`:
  - [ ] `BlockAdded` type removed
  - [ ] `BlockRemoved` type removed
  - [ ] `WireAdded` type removed
  - [ ] `WireRemoved` type removed
  - [ ] `BindingAdded` type removed
  - [ ] `BindingRemoved` type removed
  - [ ] `BusCreated` type removed
  - [ ] `BusDeleted` type removed
  - [ ] All 8 types removed from `EditorEvent` union (lines 497-505)
- [ ] Removed event emissions from stores:
  - [ ] `PatchStore.ts` no longer emits `WireAdded`, `WireRemoved`, `BlockAdded`, `BlockRemoved`
  - [ ] `BusStore.ts` no longer emits `BusCreated`, `BusDeleted`, `BindingAdded`, `BindingRemoved`
- [ ] Verified `BusBoard.tsx` and `PublishMenu.tsx` handlers are local functions (no changes needed)
- [ ] All remaining tests pass (`just test`)
- [ ] TypeScript compiles with no errors (`just typecheck`)
- [ ] UI functionality unchanged:
  - [ ] Bus creation works in UI
  - [ ] Wire/connection creation works in UI
  - [ ] Block addition works in UI
  - [ ] No console errors or warnings

### Sprint-Level Acceptance Criteria

- [ ] Both deliverables completed successfully
- [ ] TypeScript compiles cleanly (`just typecheck`)
- [ ] All remaining tests pass (`just test`)
- [ ] No runtime errors in dev mode (`just dev`)
- [ ] No regression in UI functionality (debug mode, bus creation, wire creation)
- [ ] Code is cleaner - removed ~100-150 lines of deprecated code
- [ ] No breaking changes to public API or saved patch format
- [ ] Git commit follows conventional commits format (no Claude co-author attribution)

---

## Out of Scope (Deferred)

The following are explicitly NOT part of this sprint's DOD:

- [ ] ~~paramSchema removal~~ - Deferred to next sprint (needs Inspector verification)
- [ ] ~~Feature Flags removal~~ - Deferred until IR compiler is production-ready
- [ ] ~~Legacy Type Aliases removal~~ - Out of scope (too low value)
- [ ] ~~Legacy Lens Aliases removal~~ - Out of scope (intentionally kept for compatibility)
- [ ] ~~Fixing 15 failing test files~~ - Out of scope (not legacy-related)

---

## Verification Steps

1. **Build Verification:**
   ```bash
   just typecheck  # Must pass
   just test       # Must pass (same number of failures as before, not more)
   just build      # Must succeed
   ```

2. **Runtime Verification:**
   ```bash
   just dev
   # In browser:
   # - Toggle debug/probe mode on a block (should work)
   # - Create a bus (should work)
   # - Create a wire connection (should work)
   # - Add a block (should work)
   # - Check console for errors (should be none)
   ```

3. **Code Review Checklist:**
   - [ ] No deprecated methods remain in DebugStore.ts
   - [ ] No legacy event types remain in events/types.ts
   - [ ] No event emissions for removed types in PatchStore/BusStore
   - [ ] All TODO comments related to removed code are also removed
   - [ ] No commented-out code left behind

---

## Definition of "Done"

This sprint is considered **DONE** when:

1. All acceptance criteria under "Deliverable 1" are met (✓)
2. All acceptance criteria under "Deliverable 2" are met (✓)
3. All "Sprint-Level Acceptance Criteria" are met (✓)
4. All "Verification Steps" pass (✓)
5. Changes are committed to the `refactor` branch
6. No new issues or regressions introduced

**NOT done** if any of the above are incomplete or if new runtime errors/test failures are introduced.
