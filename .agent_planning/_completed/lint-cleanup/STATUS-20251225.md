# Lint Warning Cleanup - Status Report
Timestamp: 2025-12-25
Scope: project/full
Confidence: FRESH
Git Commit: af676c5 (new-local branch)

## Executive Summary

**Total: 973 issues (252 errors, 721 warnings)**

- 77 errors auto-fixable with `eslint --fix`
- 175 errors require manual fixes
- Majority (695/721) of warnings are `functional/immutable-data` in critical path code

The lint issues fall into two distinct categories:
1. **Errors in critical-path code** - stricter rules enforced on compiler/stores/runtime/kernel
2. **Warnings everywhere** - looser rules on UI components, mostly immutability violations

---

## Issue Breakdown by Rule

### Errors (252 total)

| Rule | Count | Auto-fix? | Notes |
|------|-------|-----------|-------|
| `@typescript-eslint/strict-boolean-expressions` | 107 | No | Nullable checks in conditionals |
| `@typescript-eslint/no-unnecessary-type-assertion` | 67 | **Yes** | Redundant `as Type` casts |
| `@typescript-eslint/no-explicit-any` | 19 | No | `any` usage in critical path |
| `@typescript-eslint/no-unsafe-member-access` | 19 | No | Accessing `any` typed properties |
| `@typescript-eslint/no-unsafe-assignment` | 17 | No | Assigning `any` values |
| `@typescript-eslint/prefer-readonly` | 10 | **Yes** | Class members should be readonly |
| `@typescript-eslint/no-unsafe-call` | 4 | No | Calling `any` typed functions |
| `@typescript-eslint/no-unsafe-return` | 3 | No | Returning `any` values |
| `@typescript-eslint/no-unsafe-argument` | 2 | No | Passing `any` to typed params |
| `@typescript-eslint/no-base-to-string` | 2 | No | Object stringification issues |
| `@typescript-eslint/no-redundant-type-constituents` | 1 | No | Redundant union type |
| `@typescript-eslint/explicit-function-return-type` | 1 | No | Missing return type |

### Warnings (721 total)

| Rule | Count | Notes |
|------|-------|-------|
| `functional/immutable-data` | 695 | Mutations in compiler/stores - **intentional architecture** |
| `@typescript-eslint/strict-boolean-expressions` | 18 | In non-critical UI code |
| `react-hooks/exhaustive-deps` | 5 | Hook dependency issues |
| `@typescript-eslint/explicit-module-boundary-types` | 2 | Missing return types |
| `@typescript-eslint/no-floating-promises` | 1 | Unhandled promise |

---

## Files with Most Issues

### By `functional/immutable-data` (695 total)

| File | Count | Notes |
|------|-------|-------|
| `kernel/diff.ts` | 54 | Diff algorithm - mutation intentional |
| `compiler/compileBusAware.ts` | 49 | Bus compiler - performance critical |
| `runtime/canvasRenderer.ts` | 36 | Canvas rendering |
| `diagnostics/DiagnosticHub.ts` | 36 | Diagnostic collection |
| `stores/ViewStateStore.ts` | 33 | MobX store - mutation is the pattern |
| `compiler/unified/DependencyGraph.ts` | 32 | Graph building |
| `stores/UIStateStore.ts` | 31 | MobX store |
| `compiler/integration.ts` | 28 | Compiler integration |
| `runtime/svgRenderer.ts` | 26 | SVG rendering |
| `kernel/applyOp.ts` | 26 | Operation application |

### By `@typescript-eslint/strict-boolean-expressions` (125 total)

| File | Count | Notes |
|------|-------|-------|
| `stores/DebugStore.ts` | 23 | Nullable checks |
| `runtime/canvasRenderer.ts` | 20 | Nullable checks |
| `kernel/TransactionBuilder.ts` | 19 | Nullable checks |
| `compiler/unified/UnifiedCompiler.ts` | 10 | Nullable checks |
| `Inspector.tsx` | 8 | UI nullable strings |
| `compiler/unified/RuntimeAdapter.ts` | 7 | Nullable checks |

### By `@typescript-eslint/no-unnecessary-type-assertion` (67 total - ALL AUTO-FIXABLE)

| File | Count | Notes |
|------|-------|-------|
| `compiler/unified/__tests__/RadialOrigin.test.ts` | 24 | Test file assertions |
| `compiler/unified/__tests__/FlowFieldOrigin.test.ts` | 21 | Test file assertions |
| `compiler/unified/__tests__/EndToEnd.test.ts` | 5 | Test file assertions |
| `compiler/unified/blocks/DelayBlock.ts` | 4 | Block implementation |
| `compiler/unified/UnifiedCompiler.ts` | 3 | Compiler core |

### By `@typescript-eslint/no-explicit-any` and `no-unsafe-*` (combined 64 total)

| File | Count | Notes |
|------|-------|-------|
| `kernel/TransactionBuilder.ts` | 29 | Heavy `any` usage - **needs attention** |
| `compiler/unified/UnifiedCompiler.ts` | 7 | Type system edge cases |
| `compiler/unified/RuntimeAdapter.ts` | 6 | Adapter typing |
| `compiler/blocks/domain/FieldFromExpression.ts` | 3 | Expression eval |
| `modulation-table/ModulationTableGrid.tsx` | 3 | Grid component |

---

## Categorization by Priority

### Priority 1: Auto-fixable Errors (77)

Run `pnpm exec eslint --fix .` to fix:
- 67x `@typescript-eslint/no-unnecessary-type-assertion`
- 10x `@typescript-eslint/prefer-readonly`

**Risk: LOW** - These are safe mechanical fixes.

### Priority 2: Type Safety Errors (45)

These require manual intervention:
- 19x `@typescript-eslint/no-explicit-any`
- 17x `@typescript-eslint/no-unsafe-assignment`
- 4x `@typescript-eslint/no-unsafe-call`
- 3x `@typescript-eslint/no-unsafe-return`
- 2x `@typescript-eslint/no-unsafe-argument`

**Hotspot: `kernel/TransactionBuilder.ts`** has 29 of these 45 errors.

### Priority 3: Boolean Expression Errors (107)

All `@typescript-eslint/strict-boolean-expressions` violations.

Pattern needed:
```typescript
// Before (error in critical path)
if (value) { ... }

// After
if (value !== undefined && value !== null && value !== '') { ... }
// or more specific based on type
if (value !== undefined) { ... }
```

### Priority 4: Immutability Warnings (695)

**RECOMMENDATION: Consider disabling or scoping this rule.**

The `functional/immutable-data` rule flags 695 locations where arrays, objects, maps, or sets are mutated. However:

1. **MobX stores are designed for mutation** - That's the reactivity model
2. **Compiler/runtime needs mutable state** - Performance critical code
3. **Graph algorithms use mutation** - Standard pattern for dependency graphs

Options:
- **Option A**: Disable `functional/immutable-data` entirely
- **Option B**: Exclude stores from the rule (but keep for pure functions)
- **Option C**: Address individually with `// eslint-disable-next-line` comments (695 comments!)
- **Option D**: Mark specific files as exceptions

---

## Test vs Source Distribution

| Category | Count |
|----------|-------|
| Source files | 855 issues |
| Test files | 121 issues |

Most test file issues are:
- Unnecessary type assertions (45+ in test files)
- Immutable-data violations (setting up test fixtures)

---

## Ambiguities and Questions

### 1. Should `functional/immutable-data` be disabled?

**Context**: This rule was marked as TODO in `eslint.config.js`:
```javascript
// Detect actual mutations instead of requiring readonly type annotations
// TODO: Enable after reviewing violations
'functional/immutable-data': 'warn',
```

The rule is catching mutations that are **intentional** in this codebase:
- MobX stores rely on mutations for reactivity
- Compiler/runtime uses mutation for performance
- Diff algorithms inherently mutate during traversal

**Recommendation**: Either disable the rule or create a more specific exclusion list.

### 2. TransactionBuilder.ts has severe type issues

29 `any`-related errors in one file suggests:
- The typing may have degraded during refactoring
- There might be intentional escape hatches that need proper typing
- This file needs focused attention

### 3. Test file type assertions

45+ unnecessary type assertions in test files suggests:
- Tests may have been written with older type definitions
- Type inference improved and assertions became redundant
- Safe to auto-fix, but should verify tests still pass

---

## Recommendations

### Immediate Actions

1. **Run auto-fix** (77 errors, ~30% of all errors)
   ```bash
   pnpm exec eslint --fix .
   ```
   Then verify tests pass: `just test`

2. **Decide on `functional/immutable-data`** - 695 warnings need a policy decision

### Short-term (Next Sprint)

3. **Fix TransactionBuilder.ts** - Focus the 29 `any` errors in one file

4. **Fix strict-boolean-expressions** in priority order:
   - `DebugStore.ts` (23)
   - `canvasRenderer.ts` (20)
   - `TransactionBuilder.ts` (19)

### Long-term

5. **Add eslint-disable comments for intentional mutations** if keeping the immutable-data rule

6. **Consider adding pre-commit hook** to prevent new violations

---

## Workflow Recommendation

- [x] CONTINUE - Issues are clear, can be addressed incrementally
- [ ] PAUSE - No clarification needed

**Next action**: Run `eslint --fix` and verify tests, then decide on `functional/immutable-data` policy.
