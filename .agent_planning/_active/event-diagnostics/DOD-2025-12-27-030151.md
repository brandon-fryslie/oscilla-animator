# Definition of Done: Event System and Diagnostics Integration
**Generated**: 2025-12-27-030151
**Plan**: PLAN-2025-12-27-030151.md
**Sprint Goal**: Make diagnostics VISIBLE to users through UI integration

---

## Acceptance Criteria

### [P0] Wire DiagnosticsConsole into Editor Layout

- [ ] DiagnosticsConsole is imported in Editor.tsx
- [ ] Console is added to the right sidebar panel stack (below DebugReplPanel, above HelpPanel)
- [ ] Console has collapse/expand toggle with state persisted in useEditorLayout hook
- [ ] Console is collapsed by default to avoid overwhelming new users
- [ ] Panel header follows the same styling conventions as other panels (DebugReplPanel, HelpPanel)
- [ ] Diagnostics from DiagnosticStore are visible in the console when expanded
- [ ] Clicking on a diagnostic navigates to the target (block/bus/port) via ActionExecutor
- [ ] Severity badges (error, warn, info) render correctly with proper colors
- [ ] Mute/unmute functionality works as expected
- [ ] Layout remains responsive and does not break with console open/closed

### [P0] Add CompileFinished Event Emission from Compiler

- [ ] CompileStarted event is emitted at the start of compilation in setupAutoCompile
- [ ] CompileStarted event includes patchId and patchRevision
- [ ] CompileFinished event is emitted after compilation completes (success or failure)
- [ ] CompileFinished event includes patchId, patchRevision, success flag, and diagnostics array
- [ ] Compile errors are converted to Diagnostic objects using existing compileErrorToDiagnostic function
- [ ] DiagnosticHub receives CompileFinished events and stores diagnostics in compileSnapshots
- [ ] Compile diagnostics are visible in DiagnosticsConsole after integration (P0 item above)
- [ ] Existing unit tests for compiler continue to pass
- [ ] New integration test verifies event emission and DiagnosticHub receipt
- [ ] Compile diagnostics are cleared on successful compile (no stale errors)
- [ ] Error decorations continue to work (buildDecorations uses CompileResult, not events)

### [P1] Add Inline Diagnostic Badges on Blocks

- [ ] DiagnosticBadge component created in `src/editor/components/DiagnosticBadge.tsx`
- [ ] Badge displays severity icon (⛔ error, ⚠ warn, ℹ info) with count (e.g., "⛔ 2")
- [ ] Badge is positioned in top-right corner of block with consistent styling
- [ ] Badge integrates into Block component (likely BlockCard or BlockComponent)
- [ ] Badge uses `diagnosticStore.getDiagnosticsForBlock(blockId)` to fetch diagnostics
- [ ] Badge shows highest severity diagnostic when multiple exist
- [ ] Badge is hidden when no diagnostics exist for the block
- [ ] Clicking badge expands DiagnosticsConsole and scrolls to first diagnostic for that block
- [ ] Badge updates reactively when diagnostics change (MobX observer)
- [ ] Badge works for authoring, compile, and runtime diagnostics
- [ ] Visual design matches existing block styling (minimal, non-intrusive)

---

## Sprint Scope

This sprint delivers **3 deliverables**:
1. DiagnosticsConsole integrated into Editor UI
2. CompileFinished event emission from compiler
3. Inline diagnostic badges on blocks

**Deferred to future sprints**:
- Runtime worst offenders tracking
- Bus board badges
- Diagnostic style guide
- Semantic address (pathRef) for diagnostics
- TypeDesc canonical keys
- Diagnostic grouping (groupKey)
- diagnosticsRevision counter optimization
- Advanced action execution (multi-select, addAdapter, ApplyOnPulseBoundary)
- Time Console warnings
- Export Panel warnings
- Patch Health summary

---

## Sprint-Level Success Criteria

- [ ] All 3 work items completed with acceptance criteria met
- [ ] All existing tests pass (130 event/diagnostic tests + compiler tests)
- [ ] DiagnosticsConsole visible and functional in UI
- [ ] Compile diagnostics flow from compiler → DiagnosticHub → DiagnosticsConsole
- [ ] Blocks show inline badges for errors/warnings
- [ ] User can see and interact with diagnostics without opening DevTools
- [ ] No new TypeScript errors
- [ ] No layout regressions or visual bugs
