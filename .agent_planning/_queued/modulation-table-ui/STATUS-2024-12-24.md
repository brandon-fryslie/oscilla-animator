# STATUS: Modulation Table UI Improvements
Generated: 2024-12-24

## Topic
UI/UX improvements to the ModulationTable component in the patch panel.

## Current State Assessment

### Components Under Modification
- `src/editor/modulation-table/ModulationTable.tsx` - Main React component
- `src/editor/modulation-table/ModulationTableStore.ts` - MobX store
- `src/editor/modulation-table/types.ts` - Type definitions
- `src/editor/modulation-table/ModulationTable.css` - Styling

### Verified Issues

#### P0: CRITICAL BUG - Listener Panel Empty
**Status:** Confirmed via browser testing

The Listener panel shows "No listener ports" despite blocks having input ports.

**Root Cause:** In `ModulationTableStore.ts`:
- Line 168: OUTPUT rows use `createGroupKey('publishers', block.id)` â†’ prefix `'publishers:'`
- Line 191: INPUT rows use `createGroupKey(blockDef.subcategory ?? 'Other', block.id)` â†’ prefixes like `'Other:'`, `'Render:'`, `'TimeRoot:'`
- Line 262-263: `getRowGroupsByDirection('input')` filters for `'listeners:'` prefix

The mismatch means input row groups never match the expected `'listeners:'` prefix.

**Fix:** Change line 191 to use `createGroupKey('listeners', block.id)` OR update `getRowGroupsByDirection` to not filter by prefix for inputs.

#### P1: Sections Collapsed by Default
**Status:** Confirmed

In `types.ts` line 406-407:
```typescript
publishersSectionCollapsed: true,
listenersSectionCollapsed: true,
```

User wants sections expanded by default but individual block groups collapsed.

#### P2: Arrow Collapse Button UX
**Status:** Confirmed via screenshot

Current: Separate `â—‚`/`â–¸` buttons for collapsing sections.
Desired: Clicking the header text should collapse, remove dedicated arrow button.

#### P3: Color Column Emoji
**Status:** Confirmed via code review

In `types.ts` line 424: `'palette': 'â– '` (black square)
User wants: Rainbow emoji (ðŸŒˆ)

#### P4: Compatible Only Default + Adapter Chain Support
**Status:** Confirmed

In `types.ts` line 404:
```typescript
showOnlyCompatibleColumnsForFocusedRow: false,
```

User wants:
1. Default to `true`
2. Include adapter-chain-compatible ports (not just directly compatible)
3. Auto-apply cheap/medium adapters without confirmation
4. Show visual indicators: green dot (direct), yellow triangle (medium cost), scary emoji (heavy/explicit)

#### P5: JavaScript Tooltips
**Status:** Confirmed - currently using HTML `title` attributes

User wants styled tooltips from a library (e.g., Tippy.js, react-tooltip).

#### P6: Block Name Prefix Removal
**Status:** Confirmed via screenshot

Currently: "Other: Grid Domain", "TimeRoot: Time"
Desired: "Grid Domain", "Time"

Code location: `ModulationTableStore.ts` line 235:
```typescript
label: `${blockDef.subcategory ?? 'Other'}: ${block.label}`
```

#### P7: Port Count Display in Group Headers
**Status:** Confirmed via screenshot

Currently: "(1 ports)", "(6 ports)"
Desired: Per-column bound/available counts like "(1,2)" in green/yellow

## Dependencies
- No external tooltip library currently installed
- Adapter system already exists (`AdapterRegistry.ts`, `autoAdapter.ts`)
- Cost classification exists but limited (`getCostClass` in ModulationTableStore)

## Risks
- P0 bug fix may have ripple effects on row grouping logic
- Tooltip library addition increases bundle size
- Adapter chain UX changes require careful cost threshold tuning

## Verdict: CONTINUE
All issues are well-defined with clear fixes. Ready for planning.
