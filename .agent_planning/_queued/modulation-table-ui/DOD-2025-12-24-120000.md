# Definition of Done: MUI DataGrid Modulation Table
Generated: 2025-12-24-120000 (Revised)
Plan: PLAN-2025-12-24-120000.md

---

## Acceptance Criteria

### P0: MUI Dependencies Installed
- [ ] @mui/material in package.json dependencies
- [ ] @mui/x-data-grid in package.json dependencies
- [ ] @emotion/react in package.json dependencies
- [ ] @emotion/styled in package.json dependencies
- [ ] `just typecheck` passes (0 errors)
- [ ] `just lint` passes (0 errors, warnings OK)

### P1: MUI Theme Provider
- [ ] ThemeProvider wraps modulation table component
- [ ] Dark theme colors match app (backgrounds, text, borders)
- [ ] DataGrid renders with dark styling

### P2: ModulationTableGrid Component
- [ ] File exists: `src/editor/modulation-table/ModulationTableGrid.tsx`
- [ ] Uses MUI DataGrid component
- [ ] Rows display block name (bold) and port type (smaller, below)
- [ ] Columns display bus icons/abbreviations in header
- [ ] Cells show correct binding indicators:
  - ● (green dot) = direct binding
  - ~ (tilde) = convertible with adapter
  - × (red x) = incompatible
- [ ] Cell click calls onCellClick(rowKey, busId, event)
- [ ] **CRITICAL: Column widths do NOT change when clicking cells**
- [ ] Table width fills container (100%)
- [ ] Sticky first column (row headers stay visible on horizontal scroll)
- [ ] Sticky header row (column headers stay visible on vertical scroll)

### P3: Column Expand/Collapse
- [ ] Click compact column header → expands to show full name, type, "N pub"
- [ ] Click expanded column header → collapses to icon/abbreviation
- [ ] Expanded column visibly wider than compact columns
- [ ] Other columns shrink proportionally when one expands
- [ ] Grid still fills container width after expand/collapse
- [ ] Only one column expanded at a time (or multiple, match current behavior)

### P4: Toolbar and Filtering
- [ ] Search input present above grid
- [ ] Typing in search filters rows by label (case-insensitive)
- [ ] "Bound only" checkbox filters to rows with at least one binding
- [ ] "Compatible only" checkbox filters to show only compatible bus columns
- [ ] Filters combine with AND logic
- [ ] Clear search restores all rows

### P5: Header Tooltips (NO Cell Tooltips)
- [ ] Hover row header → tooltip shows block type, port details
- [ ] **NO tooltips on data cells**
- [ ] Tooltips have dark theme styling

### P6: Section Integration
- [ ] Draggable resizer between sections works
- [ ] Drag resizer → both grids resize responsively
- [ ] Click section header → section collapses
- [ ] Collapsed section shows vertical label bar
- [ ] Click collapsed bar → section expands
- [ ] When one section collapsed, other fills full width

### P7: Cleanup
- [ ] Old HTML table rendering code removed from ModulationTable.tsx
- [ ] Obsolete CSS table styles removed from ModulationTable.css
- [ ] No unused imports or dead code
- [ ] Component exports updated if needed

---

## Chrome DevTools Verification Tests

### Test 1: Column Width Stability (CRITICAL)
**Setup:** Load app, switch to Table view, uncheck "Compatible only"
**Action:** Click any cell in the grid
**Measure:** Column width before and after click (use DevTools)
**Pass Criteria:** Column width unchanged (±0px)

### Test 2: Table Fills Container
**Setup:** Default 50/50 split
**Measure:** DataGrid width vs .section-table-scroll width
**Pass Criteria:** Grid width === container width (±2px)

### Test 3: Responsive Resize
**Setup:** Default layout
**Action:** Drag center resizer to 70/30 split
**Measure:** Both grids fill their containers
**Pass Criteria:** No horizontal gaps, grids resize properly

### Test 4: Column Expand/Collapse
**Setup:** All columns compact
**Action:** Click "phaseA" column header
**Measure:** phaseA column width, other column widths
**Pass Criteria:**
- phaseA column wider (shows full "phaseA", "phase", "1 pub")
- Other columns narrower
- Total grid width === container width

### Test 5: Search Filter
**Setup:** Multiple rows visible
**Action:** Type "Radius" in search box
**Pass Criteria:** Only rows containing "Radius" visible

### Test 6: Section Collapse
**Setup:** Both sections visible
**Pass Criteria:**

### Test 7: Sticky Headers
**Setup:** Many rows visible (scroll needed)
**Action:** Scroll grid vertically and horizontally
**Pass Criteria:**
- Column headers stay visible at top during vertical scroll
- Row header column stays visible at left during horizontal scroll

---

## Verification Checklist

### Pre-Commit
- [ ] All 7 DevTools tests pass
- [ ] `just typecheck` passes
- [ ] `just lint` passes
- [ ] Visual inspection: dark theme looks correct
- [ ] Visual inspection: tooltips work on headers only (NOT cells)
- [ ] Visual inspection: binding indicators (●, ~, ×) display correctly

### Post-Commit
- [ ] Old HTML table code removed
- [ ] No regressions in section collapse/expand
- [ ] No regressions in resizer functionality
- [ ] App loads without console errors
